/*!
 * uu5g04 library with basic visual components
 * Copyright (C) 2021 Unicorn a.s.
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program. If not, see Licenses - GNU Project <https://gnu.org/licenses/>.
 */
"use strict";(this.__webpack_jsonp_uu5g04_1_58_8_uu5g04_bricks=this.__webpack_jsonp_uu5g04_1_58_8_uu5g04_bricks||[]).push([[2],{9002:(A,t,e)=>{e.r(t),e.d(t,{VideoHls:()=>E,default:()=>k})
;var i=e(5032),s=e.n(i),a=e(8711),o=e.n(a),n=e(4434),l=e.n(n),r=e(3985),h=e(7143),u=e(4329),c=e(2868);let d,g,p,m,B=A=>A;const C={main:()=>h.Z.css(d||(d=B`
    position: relative;
  `)),wrapper:A=>A?h.Z.css(g||(g=B`
        color: rgba(255, 255, 255, 0.7);
        visibility: hidden;
        pointer-events: none;
        position: absolute;
        right: 75px;
        top: 6px;
        opacity: 0;
        transition: opacity 0.2s, visibility 0.2s;
        z-index: 1;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: rgba(135, 135, 135, 0.99);
        border-radius: 8px;
        padding: 4px;

        .${0}:hover > & {
          pointer-events: auto;
          visibility: visible;
          opacity: 1;
        }
      `),C.main()):h.Z.css(p||(p=B`
        background: linear-gradient(0deg, transparent 0%, rgba(0,0,0,1) 100%);
        color: white;
        width: 100%;
        text-align: right;
        padding: 8px;

        visibility: hidden;
        pointer-events: none;
        position: absolute;
        top: 0;
        right: 0;
        opacity: 0;
        transition: opacity 0.2s, visibility 0.2s;
        z-index: 1;

        .${0}:hover > & {
          pointer-events: auto;
          visibility: visible;
          opacity: 1;
        }
      `),C.main()),qualityPicker:A=>{if(A)return h.Z.css(m||(m=B`
        .uu5-bricks-dropdown-button {
          background-color: transparent !important;
          color: rgba(255, 255, 255, 0.7) !important;
          min-height: auto;
        }
      `))}},Q=n.Common.VisualComponent.create({mixins:[n.Common.BaseMixin],statics:{tagName:r.Z.name("VideoSettings"),classNames:C,lsi:()=>n.Environment.Lsi.Bricks.video},propTypes:{
quality:n.PropTypes.string,qualityList:n.PropTypes.arrayOf(n.PropTypes.string),onQualityChange:n.PropTypes.func},getDefaultProps:function(){return{quality:null,qualityList:[],onQualityChange:null}},
_onQualityItemClick(A,t){let{onQualityChange:e}=this.props;"function"==typeof e&&e({value:A.props.value})},render(){let{quality:A,qualityList:t,children:e}=this.props
;const i=n.Common.Tools.isMobileIOS()||n.Common.Tools.isMac();return Uu5g05.Utils.Element.create("div",this.getMainAttrs(),Array.isArray(t)&&t.length>1?Uu5g05.Utils.Element.create("div",{
className:this.getClassName().wrapper(i)},Uu5g05.Utils.Element.create(u.Z,{key:"q",className:this.getClassName().qualityPicker(i),pullRight:!0,baseline:!0,bgStyle:"transparent",colorSchema:"white",
label:A||"",items:t.map((t=>({onClick:this._onQualityItemClick,icon:t===A?"mdi-check":void 0,value:t,label:Uu5g05.Utils.Element.create(Uu5g05.Fragment,null,Uu5g05.Utils.Element.create(c.Z,{
icon:t===A?"mdi-check":"mdi-blank"})," "+t)})))})):null,e)}}),E=l().Common.VisualComponent.create({displayName:"VideoHls",mixins:[l().Common.BaseMixin],statics:{tagName:"UU5.Bricks.Video.Hls",errors:{
hlsVideoNotSupported:"This browser does not support playing of HLS (HTTP Live Streaming) videos."}},propTypes:{videoAttrs:l().PropTypes.object,authenticate:l().PropTypes.bool,
onBeforeChunkLoad:l().PropTypes.func},getDefaultProps:()=>({videoAttrs:{},authenticate:!1,onBeforeChunkLoad:null}),getInitialState(){return this._hls=null,this._video=null,this._preloaded=!1,{
quality:null}},componentDidMount(){if(this._usesHlsLib()){let{videoAttrs:A}=this.props;this._waitForToken(A.src,(()=>{if(!this.isRendered())return;let t={autoStartLoad:A.autoPlay||"none"!==A.preload,
xhrSetup:this._hlsXhrSetup,maxBufferSize:64,maxBufferLength:30,maxMaxBufferLength:60},e=this._hls=new(o())(t);this._hls.on(o().Events.LEVEL_SWITCHING,((A,t)=>{this.setState({
quality:null!=t&&t.height?t.height+"p":void 0})})),A.src&&(A.autoPlay||"none"!==A.preload)&&this._doPreload(),
t.autoStartLoad&&"metadata"!==A.preload||l().Environment.EventListener.addEvent(this._video,"play",this.getId(),(()=>{let A=()=>e.startLoad()
;(!this._preloaded&&this.props.videoAttrs.src?()=>this._doPreload(!0,A):A)()}))}))}else this._canPlayNativeHls()||this.showError("hlsVideoNotSupported")},componentDidUpdate(A,t){
this.props.videoAttrs.src!==A.videoAttrs.src&&this._preloaded&&this._waitForToken(this.props.videoAttrs.src,(()=>{this._hls.loadSource(this.props.videoAttrs.src)}))},componentWillUnmount(){
this._unmounted=!0,l().Environment.EventListener.removeEvent(this._video,"play",this.getId()),this._hls&&this._hls.destroy()},_doPreload(A=null,t=null){let{videoAttrs:e}=this.props
;this._preloaded||(this._preloaded=!0,this._hls.attachMedia(this._video)),this._hls.loadSource(e.src),this._hls.once(o().Events.MANIFEST_PARSED,(()=>{
this._unmounted||("boolean"!=typeof A&&(A=this.props.videoAttrs.autoPlay),A?this._video.play():"metadata"===e.preload&&this._hls.once(o().Events.FRAG_PARSED,(()=>this._hls.stopLoad())),this.setState({
qualityList:(this._hls.levels||[]).map((A=>A.height+"p"))}),"function"==typeof t&&t())}))},_hlsXhrSetup(A,t){if("function"==typeof this.props.onBeforeChunkLoad){let e={url:t}
;this.props.onBeforeChunkLoad(e),e.url!==t&&A.open("GET",e.url,!0)}if(this.props.authenticate){let e=l().Environment.getSession()
;if(e&&e.isAuthenticated()&&l().Environment.isTrustedDomain(t)&&this._authenticationHeaders)for(let t in this._authenticationHeaders)A.setRequestHeader(t,this._authenticationHeaders[t])}},
_usesHlsLib:()=>o().isSupported(),_canPlayNativeHls(){
return void 0===this.constructor._canPlayNativeHls&&(this.constructor._canPlayNativeHls=document.createElement("video").canPlayType("application/vnd.apple.mpegurl")),this.constructor._canPlayNativeHls
},_setVideoRef(A){this._video=A},_getAuthenticatedUrl(A,t){let e="";if(this._authenticatedUrl===A)e=this.state.authenticatedUrl;else if(this._authenticatingUrl!==A){this._authenticatingUrl=A
;let e=this._urlPromise=this._computeAuthenticationData(A,t).then((({authenticatedUrl:t,headers:i})=>{this.isRendered()&&e===this._urlPromise&&(delete this._authenticatingUrl,this._authenticatedUrl=A,
this._authenticationHeaders=i,this.setState({authenticatedUrl:t}))}),(()=>{delete this._authenticatingUrl}))}return e},async _computeAuthenticationData(A,t){
let e=await l().Common.Tools.getCallToken(A,t),i=l().Common.Tools.getCsrfToken();return{authenticatedUrl:await l().Common.Tools.getAuthenticatedUrl(A,t,e,i),
headers:await l().Common.Tools.getAuthenticatedHeaders(A,t,e,i)}},async _waitForToken(A,t){this._authenticatedUrl===A?t():this._authenticatingUrl===A?this._urlPromise.then((()=>{this.isRendered()&&t()
})):t()},_onQualityChange({value:A}){let t=this.state.qualityList.indexOf(A);t>=0&&(this._hls.currentLevel=t)},render(){let A,{videoAttrs:t={}}=this.props,{quality:e,qualityList:i}=this.state
;if(this.props.authenticate){let e=l().Environment.getSession();e&&e.isAuthenticated()&&l().Environment.isTrustedDomain(t.src)&&(A=this._getAuthenticatedUrl(t.src,e))}if(this._usesHlsLib()){
let{autoPlay:A,src:e,...i}=t
;t=i,this._preloaded||"none"!==t.preload||(t.src="data:video/mp4;base64,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")
}else A&&(t.src=A);return Uu5g05.Utils.Element.create(Q,s()({},this.getMainPropsToPass(),{quality:e,qualityList:i,onQualityChange:this._onQualityChange}),Uu5g05.Utils.Element.create("video",s()({},t,{
ref:this._setVideoRef})))}}),k=E}}]);