const React = require("react");
const { screen, userEvent } = require("../internal/testing-library.js");
const { render } = require("../internal/render.js");
const { wait } = require("../utils/wait.js");

async function setup(Component, props, { Wrapper, queries } = {}) {
  const testId = "component-1";

  let Comp = React.createElement(Component, { ...props, testId });
  if (Wrapper) Comp = React.createElement(Wrapper, null, Comp);

  const user = userEvent.setup();
  const view = render(Comp, { queries });
  await wait();
  if (Wrapper) {
    const { rerender } = view;
    view.rerender = (Comp) => rerender(React.createElement(Wrapper, null, Comp));
  }
  const element = screen.getByTestId(testId);

  return { user, view, element, props };
}

module.exports = { setup };
