"use strict";

const CACHE_HANDLER_NAME = "uu_app_cache/monitored";

class MonitoredHandler {
  constructor(_code, _opts, chain, next) {
    this.chain = chain;
    this.next = next;
    this.hits = 0;
    this.misses = 0;
  }

  async get(awid, key, opts) {
    const value = await this.next.get(awid, key, opts);
    if (value === null) {
      this.misses++;
    } else {
      this.hits++;
    }
    return value;
  }

  getMetrics() {
    let baseMetrics = {};
    if (this.next.getMetrics) {
      baseMetrics = this.next.getMetrics();
    }

    return {
      ...baseMetrics,
      hits: this.hits,
      misses: this.misses,
    };
  }

  static get HANDLER_NAME() {
    return CACHE_HANDLER_NAME;
  }
}

module.exports = MonitoredHandler;
