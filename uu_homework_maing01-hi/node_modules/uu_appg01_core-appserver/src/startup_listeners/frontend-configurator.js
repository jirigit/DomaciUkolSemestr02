"use strict";

const { Config } = require("uu_appg01_core-utils");
const ClientConfigurator = require("../runner/client-configurator.js");

const BASE_UU5_CONFIG_PREFIX = "uu5g05_";
const BASE_PLUS4U5_CONFIG_PREFIX = "uu_plus4u5g02_";
const BASE_UU5_STRING_PREFIX = "uu5stringg01";
const CONFIG_UU5_ENVIRONMENT_VARIABLES = [
  "browserUpdate",
  "cdnBaseUri",
];

class FrontendConfigurator {
  async onStartup() {
    ClientConfigurator.registerConfigurationProvider(this);
  }

  async getClientConfiguration() {
    let result = {};

    let configObject = Config.toJSON();
    for (let key of Object.keys(configObject)) {
      if (
        key.startsWith(BASE_UU5_CONFIG_PREFIX) ||
        key.startsWith(BASE_PLUS4U5_CONFIG_PREFIX) ||
        key.startsWith(BASE_UU5_STRING_PREFIX) ||
        CONFIG_UU5_ENVIRONMENT_VARIABLES.includes(key)
      ) {
        result[key] = configObject[key];
      }
    }

    return result;
  }
}

module.exports = FrontendConfigurator;
