const Fs = require("fs-extra");

const upgradeVersion = __filename.replace(/.*upgrade-(.*)\.js$/, "$1");

module.exports = async function (config, templateInfo) {
  let { type } = templateInfo;

  if (Fs.existsSync(".eslintrc.js")) {
    console.log(`${upgradeVersion} Updating '.eslintrc.js' file to use uu5/nodejs specific settings.`);
    let content = Fs.readFileSync(".eslintrc.js", "utf-8");
    let origContent = content;
    let suffix = type.startsWith("nodejs-") ? "-nodejs" : "-uu5";
    content = content.replace(
      /uu_appg01_devkit\/src\/config\/\.eslintrc\.js/g,
      `uu_appg01_devkit/src/config/.eslintrc${suffix}.js`
    );
    if (content !== origContent) {
      Fs.writeFileSync(".eslintrc.js", content, "utf-8");
    }
  }
};
