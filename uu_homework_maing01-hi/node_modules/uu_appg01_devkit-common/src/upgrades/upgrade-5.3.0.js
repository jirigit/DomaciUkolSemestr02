const fs = require("fs-extra");

const upgradeVersion = __filename.replace(/.*upgrade-(.*)\.js$/, "$1");

module.exports = async function (config, templateInfo) {
  let { type } = templateInfo;

  if (type === "nodejs-multi" || type === "uu5-lib" || type === "lib") {
    console.log(`${upgradeVersion} Adding scripts lsiExport and lsiImport to package.json.`);
    let pkg = JSON.parse(fs.readFileSync("package.json", "utf-8"));
    if (pkg.scripts) {
      if (!pkg.scripts["lsiExport"]) pkg.scripts["lsiExport"] = "uu_appg01_devkit lsiExport";
      if (!pkg.scripts["lsiImport"]) pkg.scripts["lsiImport"] = "uu_appg01_devkit lsiImport";
      fs.writeFileSync("package.json", JSON.stringify(pkg, null, 2) + "\n", "utf-8");
    }
  }
};
