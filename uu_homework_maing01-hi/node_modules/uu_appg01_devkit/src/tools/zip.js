const fs = require("fs");
const archiver = require("archiver");

async function zip(outputPath, fn) {
  let output = fs.createWriteStream(outputPath);
  return new Promise(function (resolve, reject) {
    let archive = archiver("zip", { zlib: { level: 9 } });
    archive.on("error", reject);
    output.on("error", reject);
    output.on("close", resolve);
    archive.pipe(output);
    Promise.resolve()
      .then(() => fn(archive))
      .then(() => archive.finalize(), reject);
  });
}

module.exports = zip;
