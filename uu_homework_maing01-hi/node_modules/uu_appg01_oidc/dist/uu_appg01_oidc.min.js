/*!
 * Copyright (c) 2019 Unicorn a.s.
 * All rights reserved.
 */
!function(e,t){
"object"==typeof exports&&"object"==typeof module?module.exports=t(require("module"),require("uu_appg01_core")):"function"==typeof define&&define.amd?define("uu_appg01_oidc",["module","uu_appg01_core"],t):"object"==typeof exports?exports.uu_appg01_oidc=t(require("module"),require("uu_appg01_core")):(e.UuApp=e.UuApp||{},
e.UuApp.Oidc=t(e[void 0],e.UuApp))}(this,((e,t)=>(()=>{var i,n,s,r,o={805:(e,t,i)=>{"use strict"
;const{AuthenticationService:n,InvalidCredentials:s}=i(460),{Config:r,BaseError:o}=i(498),{LoggerFactory:a}=i(732),{AppClient:l}=i(44),c=i(357),u=i(993),h=i(782),d=i(475),_=i(16),p=i(8),g=i(585),f=i(166),m=i(624),y=i(614),w=i(46),S=i(448),k=i(668),v="uu_app_oidc_providers_",b="forward",C=/^[a-zA-Z0-9\-_]+\.[a-zA-Z0-9\-_]+\.[a-zA-Z0-9\-_]+$/
;class A{static async _onPageLoad(e){if(!this._onPageLoadPromise){this._onPageLoadFinished=!1;let t=async function(){if("disabled"!==d.getRestoreSessionOnLoad())await this.restoreSession({callToken:e
});else{let e=this._providers[this._primaryProvider];e&&await e._loadAsyncData()}this._onPageLoadFinished=!0}.bind(this);this._onPageLoadPromise=t()}return this._onPageLoadPromise}static load(e=!1){
c.load(A,e)}static create(e,t={}){if(!(t.force||!1)&&this._providers[e])return;let i=new this(e,t);n._register(e,i),n._register("uu_appg01_oidc",this),this._providers[e]=i,
this._primaryProvider||(this._primaryProvider=e),this._restoreSessionPromise=null,this._isRestoringSession=!1,this._logger=a.get("uuapp.oidc.AuthenticationService")}
static async authenticate(e,t=null){this._onPageLoadPromise||this._onPageLoad(null),this._onPageLoadFinished||await this._onPageLoadPromise;let i=this._providers[this._primaryProvider]
;return await i.authenticate(e,t)}static isAuthenticating(){let e=this._providers[this._primaryProvider];return e?e.isAuthenticating():null}static getServiceName(){
let e=this._providers[this._primaryProvider];return e?e.getServiceName():null}static async getServiceUri(){let e=this._providers[this._primaryProvider];return e?await e.getServiceUri():null}
static getProviderUri(){let e=this._providers[this._primaryProvider];return e?e.getProviderUri():null}static getCurrentSession(){let e=this._providers[this._primaryProvider]
;return e?e.getCurrentSession():null}static async restoreSession(e={}){let t=sessionStorage.getItem("uu_app_oidc_auth_referrer");if(sessionStorage.removeItem("uu_app_oidc_auth_referrer"),
document.originalReferrer=t||"",!this._restoreSessionPromise){this._isRestoringSession=!0;let t=async function(){let t=r.getBoolean("uu_app_oidc_secondary_providers_enabled");if(null==t&&(t=!1),
t&&1!==Object.keys(this._providers).length){this._logger.debug("Trying to restore session for any available authentication service.");let t=[];t.push(this._providers[this._primaryProvider])
;for(let e of Object.values(this._providers))e.getServiceName()!==this._primaryProvider&&t.push(e);let i=[],n=null,s=this._primaryProvider;for(let r of t){this._primaryProvider=r.getServiceName();try{
if(n=await r.restoreSession(e),n.getIdentity()&&n.getIdentity().getUuIdentity()){this._logger.debug(`Setting ${r.getServiceName()} as default service.`);break}}catch(e){i.push([r.getServiceName(),e])}
this._primaryProvider=s}if(n.getIdentity())return this._isRestoringSession=!1,n;if(this._logger.debug(`No existing session found, keeping ${this._primaryProvider} as default service.`),i.length>0){
for(let[e,t]of i)this._logger.error(`Authentication with ${e} failed.`,t);throw this._isRestoringSession=!1,i.pop()[1]}return this._isRestoringSession=!1,n}try{
return await this._providers[this._primaryProvider].restoreSession(e)}finally{this._isRestoringSession=!1}}.bind(this);this._restoreSessionPromise=t()}return this._restoreSessionPromise}
static isRestoringSession(){return this._isRestoringSession}static addListener(e,t){let i=[];for(let n of Object.values(this._providers))i.push(n.addListener(e,t));return function(){for(let e of i)e()
}}static removeListener(e,t){for(let i of Object.values(this._providers))i.removeListener(e,t)}static isSessionExpiring(){let e=this._providers[this._primaryProvider]
;return e?e.isSessionExpiring():null}static _triggerEvent(e,t){for(let i of Object.values(this._providers))i._triggerEvent(e,t)}constructor(e,t={}){if(!e)throw new o("Service name is not defined")
;if(this._serviceName=e,this._serviceUri=t.serviceUri,!this._serviceUri)throw new o(`There is no service URI defined for service ${this._serviceName}`);this._oauthClient=null,
this._loadOauthClientPromise=this._loadOauthClient(this._serviceName,this._serviceUri,t),this._callTokenType=t.callTokenType,this._callTokenIntrospectAge=t.callTokenIntrospectAge,
this._emptySession=w.from(h._createEmptySession(),void 0,void 0,void 0,void 0,this),this._currentSession=this._emptySession,this._runningAuthnPromise=null,this._restoreSessionPromise=null,
this._isRestoringSession=!1,this._listeners=[],this._globalSessionExpiring=!1,this._defaultAcrValues=r.getString("uu_app_oidc_requested_acr_values",!1)||"low standard high veryHigh",
this._defaultMaxAge=r.getNumber("uu_app_oidc_max_authentication_age",!1),this._defaultScopeMode=r.getString(v+this._serviceName+"_default_call_token_scope_mode")||"baseUri",
this._logger=a.get("uuapp.oidc.AuthenticationService"),this._redirectUri=S.toFullAppUrl(r.getString("uu_app_oidc_redirect_uri")||"/oidc/callback"),this._authnFlow=null,
this._loadAuthnFlowPromise=this._loadAuthnFlow(),this._autoLogoutSupportInitialized=!1,this._autoTokenRefreshInitialized=!1,this._sessionExtendedAndExpiringSupportInitialized=!1,
this._sessionStateChangeNotifierInitialized=!1}getServiceName(){return this._serviceName}async getServiceUri(){return this._oauthClient||await this._loadOauthClientPromise,
(await this._oauthClient.getIssuerList())[0]}getProviderUri(){return this._serviceUri}getCurrentSession(){return this._currentSession}async restoreSession(e={}){if(!this._restoreSessionPromise){
this._isRestoringSession=!0,this._logger.debug(`Trying to restore session for ${this.getServiceName()}.`)
;let t,i,{acrValues:n,maxAge:s,callToken:r}=e||{},o=await m.getClientId(this._serviceName),a=w.loadFromCache(this,o)
;a&&a.matches(n||this._defaultAcrValues,s||this._defaultMaxAge)?(this._logger.debug(`Session for ${this.getServiceName()} loaded from cache.`),t=this._authenticateBySession.bind(this),
i=a):r?(this._logger.warn(`Trying to initialize session by access_token for ${this.getServiceName()}. This method is deprecated and is going to be removed!`),
t=this._authenticateByCallToken.bind(this),i=r):(t=this._restoreSession.bind(this),i={acrValues:n,maxAge:s}),
this._restoreSessionPromise=t(i).then((e=>(this._logger.debug(`Session for ${this.getServiceName()} restored.`),this._isRestoringSession=!1,
e)),(e=>(e&&(e.code&&e.code.match(/(interaction|login|account_selection|consent)_required/i)||e.message&&e.message.match(/interaction required/i))?this._logger.debug(`Restore of session for ${this.getServiceName()} failed, user interaction is required (${e.code}).`):this._logger.error(`Restore of session for ${this.getServiceName()} failed.`,e),
this._isRestoringSession=!1,this._currentSession)))}return this._restoreSessionPromise}isRestoringSession(){return this._isRestoringSession}checkSession(e=!1){
return e&&this._currentSession&&this._currentSession.isAuthenticated()?this._silentTokenRefresh(!0):this._sessionChecker&&this._sessionChecker._checkState(),null}async authenticate(e,t=null){
if(this._runningAuthnPromise&&this._equalsArray(this._runningAuthnArgs,Array.prototype.slice.call(arguments))){let{uiComponent:e}=this._runningAuthnPromise
;return e&&"function"==typeof e.focus&&e.focus(),this._runningAuthnPromise}let i;this._oauthClient||await this._loadOauthClientPromise,
e&&e.os8Token?i=new f(this._oauthClient,this._serviceName,this._redirectUri):(this._authnFlow||await this._loadAuthnFlowPromise,i=this._authnFlow)
;let n=e&&e.scopeMode?e.scopeMode:this._defaultScopeMode;t&&0!=t.length||"none"===n||(t=(t=S.canonicalAppBaseUri||S.appBaseUri).replace(/\/$/,""));try{
this._runningAuthnArgs=Array.prototype.slice.call(arguments),this._runningAuthnPromise=i.authenticate(e,t)
;let n=await this._runningAuthnPromise,s=await this._oauthClient.getSupportedAcrValues(),r=new h(this._serviceName,this._oauthClient,s,n.claims,n.idToken,n.accessToken)
;return r=w.from(r,n.authenticationContext,n.globalSessionExpiresAt,n.globalSessionState,this),r._authConstraints={scope:n.scope,acrValues:n.acrValues,maxAge:n.maxAge},this._currentSession=r,
this._initHandlers(),r&&(r._onCloseListener=this._onSessionClose.bind(this),r.storeToCache(n.clientId)),this._triggerEvent("sessionChanged",r),r}finally{this._runningAuthnArgs=[],
this._runningAuthnPromise=null}}isAuthenticating(){return!!this._runningAuthnPromise}addListener(e,t){let i=this._listeners[e];return i||(i=this._listeners[e]=[]),i.push(t),
this.removeListener.bind(this,e,t)}removeListener(e,t){let i=this._listeners[e];if(!i)return!1;let n=i.indexOf(t);return-1!=n&&i.splice(n,1),-1!=n}isSessionExpiring(){
return this._globalSessionExpiring}async _loadAsyncData(){this._oauthClient||await this._loadOauthClientPromise,await this._oauthClient.getMetadata(),await m.getClientId(this._serviceName)}
async _loadOauthClient(e,t,i){r.getBoolean(v+e+"_mtls_enabled",!1)&&(i.mtlsGateway=r.get(v+e+"_mtls_gateway"));let n=r.get(v+e+"_oauth_frontend_realization");if(n){if("string"==typeof n)try{
n=await SystemJS.import(n)}catch(e){throw new o("Unable to load custom oauth realization.",e)}if("function"==typeof n)this._oauthClient=new n(t,i);else{
if("object"!=typeof n)throw new o(`Oauth realization '${n}' is not supported.`);this._oauthClient=n}}else this._oauthClient=new u(t,i)}async _loadAuthnFlow(){
this._oauthClient||await this._loadOauthClientPromise;let e=r.get("uu_app_oidc_authn_flow_override");if(e){if("string"==typeof e)try{e=await SystemJS.import(e)}catch(e){
throw new o("Unable to load authentication flow override.",e)}if("function"==typeof e)this._authnFlow=new e(this._oauthClient,this._serviceName,this._redirectUri,S.appBaseUri);else{
if("object"!=typeof e)throw new o(`Authentication flow override '${e}' is not supported.`);this._authnFlow=e}}else{
let e=r.getString(v+this._serviceName+"_authentication_type")||"implicit",t=r.getString(v+this._serviceName+"_session_crossdomain_strategy")||"cookie",i=r.getBoolean("uu_app_oidc_backend_available")
;if("code"!==e||i||(this._logger.warn("Authentication type [code] requested, but no comatible backend found. Switching to [implicit]."),e="implicit"),
"implicit"===e)t===b&&this._logger.warn("Session crossdomain strategy set to [forward] which is not supported by authentication type [implicit]. Configuration is ignored."),
this._authnFlow=new _(this._oauthClient,this._serviceName,this._redirectUri,S.appBaseUri);else{if("code"!==e)throw new o(`Authentication type '${e}' is not supported.`)
;t===b?r.getBoolean("uu_app_oidc_backend_grant_call_token_available")?this._authnFlow=new g(this._oauthClient,this._serviceName,this._redirectUri,S.appBaseUri):(this._logger.warn("Session crossdomain strategy set to [forward] which is not supported by application backend. Configuration is ignored."),
this._authnFlow=new p(this._oauthClient,this._serviceName,this._redirectUri,S.appBaseUri)):this._authnFlow=new p(this._oauthClient,this._serviceName,this._redirectUri,S.appBaseUri)}}}
async _restoreSession(e){if(this._runningAuthnPromise&&this._equalsArray(this._runningAuthnArgs,Array.prototype.slice.call(arguments))){let{uiComponent:e}=this._runningAuthnPromise
;return e&&"function"==typeof e.focus&&e.focus(),this._runningAuthnPromise}let t,i;this._oauthClient||await this._loadOauthClientPromise,
e&&e.os8Token?t=new f(this._oauthClient,this._serviceName,this._redirectUri):(this._authnFlow||await this._loadAuthnFlowPromise,t=this._authnFlow),
"none"!==(e&&e.scopeMode?e.scopeMode:this._defaultScopeMode)&&(i=S.canonicalAppBaseUri||S.appBaseUri,i=i.replace(/\/$/,""));try{this._runningAuthnArgs=Array.prototype.slice.call(arguments),
t.restoreSession?this._runningAuthnPromise=t.restoreSession(e,i):(e={prompt:"none",...e},this._runningAuthnPromise=t.authenticate(e,i))
;let n=await this._runningAuthnPromise,s=await this._oauthClient.getSupportedAcrValues(),r=new h(this._serviceName,this._oauthClient,s,n.claims,n.idToken,n.accessToken)
;return r=w.from(r,n.authenticationContext,n.globalSessionExpiresAt,n.globalSessionState,this),r._authConstraints={scope:n.scope,acrValues:n.acrValues,maxAge:n.maxAge},this._currentSession=r,
this._initHandlers(),r&&(r._onCloseListener=this._onSessionClose.bind(this),r.storeToCache(n.clientId)),this._triggerEvent("sessionChanged",r),r}finally{this._runningAuthnArgs=[],
this._runningAuthnPromise=null}}async _authenticateBySession(e){let t=async function(){return await m.getClientId(this._serviceName),this._oauthClient||await this._loadOauthClientPromise,
await this._oauthClient.getSupportedAcrValues(),{session:e,authCtx:e.getAuthenticationContext(),globalSessionExpiresAt:e.getExpiresAt(),globalSessionState:e.getState()}}.bind(this);try{
return this._runningAuthnPromise=t(),await this._runningAuthnPromise,this._currentSession=e,this._initHandlers(),e&&(e._onCloseListener=this._onSessionClose.bind(this)),
this._triggerEvent("sessionChanged",e),e}finally{this._runningAuthnArgs=[],this._runningAuthnPromise=null}}async _authenticateByCallToken(e){let t=async function(){let t,i,n
;if(this._oauthClient||await this._loadOauthClientPromise,e.match(C)){if(t=await this._oauthClient.parseToken(e,this._callTokenType),
null!=this._callTokenIntrospectAge&&t.iat&&t.iat+this._callTokenIntrospectAge<Date.now()/1e3){let i=new l({baseUri:S.canonicalAppBaseUri||S.appBaseUri}),n={authorization:`Bearer ${e}`},s={_:Date.now()
};t=(await i.get("oidc/introspect",s,{headers:n})).data}"idToken"===this._callTokenType?(i=e,n=null):"accessToken"===this._callTokenType?(i=null,n=e):(i=e,n=null)}else{let s=new l({
baseUri:S.canonicalAppBaseUri||S.appBaseUri}),r={authorization:`Bearer ${e}`},o={_:Date.now()};t=(await s.get("oidc/introspect",o,{headers:r})).data,"idToken"===this._callTokenType?(i=e,
n=null):(this._callTokenType,i=null,n=e)}if(!(await this._oauthClient.getIssuerList()).includes(t.iss))throw new s("Token is not trusted (unknown token issuer).")
;await m.getClientId(this._serviceName);let r=await this._oauthClient.getSupportedAcrValues(),o=new h(this._serviceName,this._oauthClient,r,t,i,n);return o=w.from(o,null,null,null,null,this),
o.getCallToken=async function(e=null,t={}){let i=this._idToken||this._accessToken;if(i){return!0===(!!t&&t.excludeAuthenticationType)?i:`Bearer ${i}`}return null}.bind(o),o.close=async function(){
this.removeFromCache(),this._authenticated&&"function"==typeof this._onCloseListener&&this._onCloseListener(this),this._authenticated=!1,this._idToken=null,this._accessToken=null}.bind(o),{session:o}
}.bind(this);try{this._runningAuthnPromise=t();let{session:e}=await this._runningAuthnPromise;return this._currentSession=e,e&&(e._onCloseListener=this._onSessionClose.bind(this)),
this._triggerEvent("sessionChanged",e),e}finally{this._runningAuthnArgs=[],this._runningAuthnPromise=null}}_initHandlers(){this._autoLogoutSupportInitialized||(this._initAutoLogoutSupport(),
this._autoLogoutSupportInitialized=!0),this._autoTokenRefreshInitialized||(this._initAutoTokenRefresh(),this._autoTokenRefreshInitialized=!0),
this._sessionExtendedAndExpiringSupportInitialized||(this._initSessionExtendedAndExpiringSupport(),this._sessionExtendedAndExpiringSupportInitialized=!0),
this._sessionStateChangeNotifierInitialized?this._sessionChecker&&this._sessionChecker.enable():(this._initSessionStateChangeNotifier(),this._sessionStateChangeNotifierInitialized=!0)}
_initAutoLogoutSupport(){let e;this.addListener("sessionChanged",(t=>{if(e&&(clearTimeout(e),e=null),!this._currentSession||!this._currentSession.isAuthenticated())return
;let i=this._currentSession.getExpiresAt()||1e3*(this._currentSession.getAttribute("exp")||0);if(!i)return;let n=Date.now(),s=Math.max(0,i-n)
;this._logger.debug(`Planning local auto-logout at ${this._toTimeString(new Date(n+s))}.`),e=setTimeout((()=>{e=null,this._localLogout()}),s)}))}_initAutoTokenRefresh(){
let e=r.getBoolean(v+this._serviceName+"_token_refresh_enabled");null==e&&(e=!0);let t=r.getNumber(v+this._serviceName+"_token_refresh_leeway");null==t&&(t=300)
;let i=r.getNumber(v+this._serviceName+"_token_refresh_failure_retry_interval");(null==i||i<0)&&(i=30),i&&(i=Math.max(5,i))
;let n,s=r.getNumber(v+this._serviceName+"_token_refresh_failure_retry_count");(null==s||s<0)&&(s=3),this._tokenRefreshInProgressCount=0,this._tokenRefreshFailureRetryInterval=i,
this._tokenRefreshFailureRetryCount=s,this._tokenRefreshFailureRetryTimer=null,this.addListener("sessionChanged",(i=>{if(!e)return;n&&(clearTimeout(n),n=null)
;let s,r=this._currentSession&&this._currentSession.isAuthenticated()&&1e3*this._currentSession.getAttribute("exp");if(!r)return;let o=Date.now(),a=r-o
;if(a<=0)return this._logger.warn("Received already expired token due to expired session - ending with local logout."),void this._localLogout()
;a<1e3*t?(this._logger.warn(`Received token with unexpectedly short expiration time of ${Math.floor(a/1e3)}s. Either session is nearing expiration, or current configuration of automatic token refresh is not suitable for used oidc provider.`),
s=a-Math.floor(a/10)):s=a-1e3*t,s=Math.max(s,1e3),this._logger.debug(`Planning token auto-refresh at ${this._toTimeString(new Date(o+s))}.`),n=setTimeout((()=>{n=null,this._silentTokenRefresh()}),s)
})),e&&(window.addEventListener("focus",(()=>this.checkSession(!0))),document.addEventListener("visibilitychange",(()=>"visible"===document.visibilityState&&this.checkSession(!0))))}
_initSessionExtendedAndExpiringSupport(){let e=r.getNumber(v+this._serviceName+"_session_extend_by_client_cert_failure_retry_interval");(null==e||e<0)&&(e=30),e&&(e=Math.max(5,e))
;let t=r.getNumber(v+this._serviceName+"_session_extend_by_client_cert_failure_retry_count");(null==t||t<0)&&(t=3),this._sessionExtendByClientCertFailureRetryInterval=e,
this._sessionExtendByClientCertFailureRetryCount=t;let i;this.addListener("sessionChanged",(e=>{let t=this._currentSession.getExpiresAt()||0,n=i&&t>i+1e4;if(i=t,n){this._globalSessionExpiring=!1
;let e=i;setTimeout((()=>{this._triggerEvent("sessionExtended",{expiresAt:e})}),0)}}));let n,s,o=r.getNumber(v+this._serviceName+"_session_expiring_notification_time");null==o&&(o=1800),
this.addListener("sessionChanged",(e=>{if(o<=0)return;s&&(clearTimeout(s),s=null)
;let t=this._currentSession&&this._currentSession.isAuthenticated()&&this._currentSession.getIdentity(),i=t&&t.getUuIdentity();i!=n&&(this._globalSessionExpiring=!1),n=i
;let r=this._currentSession.getExpiresAt();if(!r)return;if(this._globalSessionExpiring)return;let a=Date.now(),l=Math.max(0,r-a-1e3*o)
;this._logger.debug(`Planning sessionExpiring notification at ${this._toTimeString(new Date(a+l))}.`),s=setTimeout((async()=>{s=null,
await this._trySilentSessionExtendByClientCert()||(this._globalSessionExpiring=!0,this._triggerEvent("sessionExpiring",{expiresAt:r}))}),l)})),this.addListener("sessionExpiring",(e=>{
let t=e.data.expiresAt,i=Math.floor((t-Date.now())/2);i>5e3&&(s&&clearTimeout(s),s=setTimeout((()=>{s=null,this._globalSessionExpiring=!0,this._triggerEvent("sessionExpiring",{expiresAt:t})}),i))}))}
async _initSessionStateChangeNotifier(){let e=r.getNumber(v+this._serviceName+"_session_check_interval");if(null==e&&(e=5),e&&await this._authnFlow.isCheckSessionSupported()){
let t=await m.getClientId(this._serviceName);this._sessionChecker=new y(this._authnFlow,e,t,(()=>this._currentSession.getState())),this._sessionChecker.onStateChange((()=>{
this._logger.info("Session state change detected."),this._silentTokenRefresh(!0)})),this._sessionChecker.onStateUnknown((()=>{this._logger.info("Unexpected session loss detected."),
this._triggerEvent("sessionLost")}))}}_triggerEvent(e,t){this._logger.debug(`Launching event "${e}".`);let i=this._listeners[e];if(i){let n={type:e,data:t};i.forEach((e=>e.call(this,n)))}}
_onSessionClose(e){this._localLogout()}_localLogout(){this._logger.debug("Performing local-logout."),this._currentSession.removeFromCache(),
this._currentSession!=this._emptySession&&(this._currentSession=this._emptySession,this._globalSessionExpiring=!1,this._triggerEvent("sessionChanged",this._currentSession)),
this._sessionChecker&&this._sessionChecker.disable(),this._tokenRefreshFailureRetryTimer&&(clearTimeout(this._tokenRefreshFailureRetryTimer),this._tokenRefreshFailureRetryTimer=null)}
async _silentTokenRefresh(e=!1){if(e&&(this._tokenRefreshFailureRetryTimer||this._tokenRefreshInProgressCount>0))return
;this._tokenRefreshFailureRetryTimer&&(clearTimeout(this._tokenRefreshFailureRetryTimer),this._tokenRefreshFailureRetryTimer=null);let t=0,i=async()=>{
if(this._currentSession&&this._currentSession.isAuthenticated()){this._logger.debug("Silent token refresh - starting."),++this._tokenRefreshInProgressCount;try{await this._doAuthenticateRefresh(),
--this._tokenRefreshInProgressCount}catch(e){--this._tokenRefreshInProgressCount,
this._tokenRefreshFailureRetryTimer?this._logger.debug("Silent token refresh - ending current run with no-op (operation ended with unexpected error and another retry is already planned).",e):this._tokenRefreshFailureRetryCount&&t<this._tokenRefreshFailureRetryCount?(this._logger.debug(`Silent token refresh - ended with unexpected error, will retry in ${this._tokenRefreshFailureRetryInterval}s.`,e),
this._tokenRefreshFailureRetryTimer=setTimeout((()=>{++t,this._tokenRefreshFailureRetryTimer=null,i()
}),1e3*this._tokenRefreshFailureRetryInterval)):(this._logger.debug("Silent token refresh - ended with unexpected error (and no more retries are allowed). Logging out.",e),this._localLogout())}}}
;await i()}async _trySilentSessionExtendByClientCert(){if(!r.getBoolean(v+this._serviceName+"_mtls_enabled",!1))return;let e=0,t=async()=>{
this._logger.debug("Silent Session extend by Client Certificate - starting.");try{let e=this._currentSession.getAuthenticationTime().getTime()/1e3,t=Date.now()/1e3,i=Math.round(t-e-5)
;return await this.authenticate({prompt:"none",maxAge:i}),this._logger.debug("Silent Session extend by Client Certificate - Session was extended"),!0}catch(i){
return this._sessionExtendByClientCertFailureRetryCount&&e<this._sessionExtendByClientCertFailureRetryCount?(this._logger.debug(`Silent Session extend by Client Certificate - ended with unexpected error, will retry in ${this._sessionExtendByClientCertFailureRetryInterval}s.`,i),
await this._waitFor(1e3*this._sessionExtendByClientCertFailureRetryInterval),++e,
t()):(this._logger.debug("Silent Session extend by Client Certificate - ended with unexpected error (and no more retries are allowed).",i),!1)}};return await t()}_waitFor(e){
return new Promise(((t,i)=>{setTimeout((()=>{t()}),e)}))}_equalsArray(e,t){return e.length===t.length&&e.every(((e,i)=>e===t[i]))}_toTimeString(e){
return("0"+e.getHours()).substr(-2)+":"+("0"+e.getMinutes()).substr(-2)+":"+("0"+e.getSeconds()).substr(-2)}async _doAuthenticateRefresh(){try{this._oauthClient||await this._loadOauthClientPromise,
this._authnFlow||await this._loadAuthnFlowPromise;let e,t=this._currentSession?this._currentSession._authConstraints:null,i=t?t.scope:null,n=t?t.acrValues:null,s=t?t.maxAge:null
;if(e=this._authnFlow.refreshSession?await this._authnFlow.refreshSession({acrValues:n,maxAge:s},i):await this._authnFlow.authenticate({acrValues:n,maxAge:s,prompt:"none",usePopup:!1},i),
this._currentSession&&this._currentSession.isAuthenticated()){let i
;i=this._currentSession&&this._currentSession._supportedAcrValues?this._currentSession._supportedAcrValues:await this._oauthClient.getSupportedAcrValues()
;let n=new h(this._serviceName,this._oauthClient,i,e.claims,e.idToken,e.accessToken),s=this._currentSession.getIdentity(),r=n.getIdentity()
;if(s&&r&&s.getUuIdentity()!==r.getUuIdentity()||(!s||!r)&&s!=r)this._logger.debug("Silent token refresh - ending with local logout (user that is logged in on remote is different from the local one)."),
this._localLogout();else{this._logger.debug("Silent token refresh - ending with token renewed.");let i=this._currentSession.getAuthenticationContext()
;n=w.from(n,i,e.globalSessionExpiresAt,e.globalSessionState,this),n._authConstraints=t,this._currentSession=n,n&&(n._onCloseListener=this._onSessionClose.bind(this),n.storeToCache(e.clientId)),
this._triggerEvent("sessionChanged",n)}}else this._logger.debug("Silent token refresh - ending with no-op (local session is already logged out).")}catch(e){
if(!(e instanceof k))throw this._logger.error("Silent token refresh failed.",e),e;this._logger.debug(`Silent token refresh ending with local logout, user interaction is required (${e.code}).`),
this._localLogout()}}}A._providers={},A._primaryProvider=null,A.load(!1),e.exports=A},336:(e,t,i)=>{"use strict";String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{
value:function(e,t){return t=!t||t<0?0:+t,this.substring(t,t+e.length)===e}});let n,s,r=!1;if(e.exports={get AuthenticationService(){return i(805)},get Session(){let t=i(782);return r||(r=!0,
i(367).wrapClass(t,e.exports.AuthenticationService)),t},get Internal(){return{get OAuthClient(){return i(993)},get AbstractAuthorizationFlow(){return i(475)},get ImplicitFlow(){return i(16)},
get CodeFlow(){return i(8)},get AccessPolicyVerificationHandler(){return i(72)}}},get OidcAuthenticationService(){return this.AuthenticationService},get OidcSession(){return this.Session}},
window.UuOidc||(window.UuOidc={Session:e.exports.Session}),window.history&&window.history.replaceState){let e=location.href.match(/[?&]?access_token=([^&#]+)/);if(e){n=e[1];try{
var o=location.href.replace(/([?&])access_token=[^&#]*(&)?/,((e,t,i)=>i?t:""));o!==location.href&&history.replaceState(history.state,"",o)}catch(e){}}}
s="interactive"===document.readyState||"complete"===document.readyState?Promise.resolve():new Promise((e=>{document.addEventListener("DOMContentLoaded",e,!1)})),s.then((()=>{
e.exports.AuthenticationService._onPageLoad(n)}))},668:(e,t,i)=>{"use strict";const{AuthenticationError:n}=i(460);e.exports=class extends n{}},475:(e,t,i)=>{"use strict"
;const n=i(448),s=i(605),r=i(604),o=i(119),a=i(30),l=i(668),c=i(624),{AuthenticationError:u}=i(460),{Config:h,Base64:d,BaseError:_}=i(498),{LoggerFactory:p}=i(732),g="uuAppOidcRestoreSessionOnLoad",f="uu_app_oidc_providers_",m=655,y=875,w={
enabled:{oidcg01:!0,oidcg02:!0},width:{oidcg01:599,oidcg02:m},height:{oidcg01:600,oidcg02:y}},S={type:{oidcg01:"iframe",oidcg02:"iframe"},popupWidth:{oidcg01:599,oidcg02:m},popupHeight:{oidcg01:600,
oidcg02:y}};e.exports=class{static getRestoreSessionOnLoad(){let e=document.querySelector(`meta[${g}]`),t=e?e.attributes[g].value:null;return t||(t=h.getString("uu_app_oidc_restore_session_on_load"),
null==t||"true"===t?t="optional":"false"===t&&(t="disabled")),t}constructor(e,t,i){this._oauthClient=e,this._serviceName=t,this._defaultRedirectUri=i;let n=h.getBoolean(f+t+"_login_popup_enabled")
;null==n?(n=w.enabled[t],this._popupEnabled=null==n||n):this._popupEnabled=n,this._defaultAcrValues=h.getString("uu_app_oidc_requested_acr_values",!1),
this._defaultMaxAge=h.getNumber("uu_app_oidc_max_authentication_age",!1),this._logger=p.get("uuapp.oidc.internal."+t+"."+this.constructor.name),this._checkSessionIframe=null,
this._loadCheckSessionIframePromise=null,this._runningCheckSessionPromise=null,this._runningCheckSessionResolve=null}getResponseType(){
throw new Error("AbstractFlow.getResponseType must be implemented on child class.")}createAuthState(e=null,t=null){return{r:Math.random().toString(32).substr(2),
appUri:location.pathname+location.search+(location.hash.length>1?location.hash:""),authCtx:e,usePopup:t}}restoreSession(e,t=null){return this.authenticate(e,t)}authenticate(e,t=null){let i,n
;return n=(async()=>{let l,u,{acrValues:h,maxAge:p,prompt:g,language:f,usePopup:m,authenticationContext:y,loginHint:w,noIframe:S}=e||{};if(null==h&&(h=this._defaultAcrValues),
null==p&&(p=this._defaultMaxAge),null==m&&(m=!0),m=m&&this._popupEnabled,"none"===g)u=await c.getClientId(this._serviceName),
l=await this._oauthClient.getAuthorizationUri(this.getResponseType(),this._defaultRedirectUri,u,h,t);else{try{u=c.getClientIdSync(this._serviceName)}catch(e){
throw e instanceof a&&(this._logger.debug("Trying to reload client id on background."),c.getClientId(this._serviceName)),
new _(`Unable to get client credentials for service ${this._serviceName}: ${e.message}`,e)}try{l=this._oauthClient.getAuthorizationUriSync(this.getResponseType(),this._defaultRedirectUri,u,h,t)
}catch(e){throw e instanceof a&&(this._logger.debug("Trying to reload service metadata on background."),this._oauthClient.getMetadata()),
new _(`Unable to get metadata of service ${this._serviceName}: ${e.message}`,e)}}
let k=Math.random().toString(32).substr(2),v=d.urlSafeEncode(JSON.stringify(this.createAuthState(y,m))),b=this._addUriParams(l,{max_age:p,login_hint:w,prompt:g,state:v,nonce:k,language:f
}),C="none"!==g||S?m?s:o:r;this._logger.debug(`Invoking authorization request: ${b}`);let A=this.sendRequest(b,C);return n?n.uiComponent=A.uiComponent:i=A.uiComponent,{authResponse:await A,state:v,
nonce:k,scope:t,acrValues:h,maxAge:p,clientId:u}})(),i&&(n.uiComponent=i),n}getAuthResponseFromCallback(e){
throw new Error("AbstractFlow.getAuthResponseFromCallback must be implemented on child class.")}async isCheckSessionSupported(){
return null==this._loadCheckSessionIframePromise&&(this._loadCheckSessionIframePromise=this._loadCheckSessionIframe()),await this._loadCheckSessionIframePromise,!!this._checkSessionIframe}
checkSession(e){return this._runningCheckSessionPromise||(this._runningCheckSessionPromise=new Promise(((t,i)=>{this._runningCheckSessionResolve=t,this.isCheckSessionSupported().then((t=>{
if(!t)return this._runningCheckSessionResolve=null,this._runningCheckSessionPromise=null,i(new _("Check session is not supported."))
;this._logger.debug(`Querying session state change from check session iframe. Query: ${e}`),this._checkSessionIframe.contentWindow.postMessage(e,this._iframeTrustedOrigin)}))}))),
this._runningCheckSessionPromise}refreshSession(e,t=null){return this.authenticate(e,t)}async getCallToken(e,t=null){let{idToken:i,accessToken:n,claims:s}=await this.authenticate(e,t);return{
idToken:i,accessToken:n,expireAt:1e3*s.exp}}getEndSessionUri(){throw new Error("AbstractFlow.getEndSessionUri must be implemented on child class.")}isEndSessionIdTokenHintRequired(){return!0}
async endSession(e){let t=this.getEndSessionUri(),i=null,a=h.getBoolean(f+e.getServiceName()+"_logout_token_hint_enabled");if(a=null==a||a,a&&this.isEndSessionIdTokenHintRequired()){
let n=`${f}${e.getServiceName()}_default_call_token_scope_mode`;if("none"===(h.getString(n)||"baseUri"))i=e._idToken;else try{
this._logger.debug("Obtaining token to be used as id_token_hint for end session request.");let n={callTokenType:"idToken",excludeAuthenticationType:!0};i=await e.getCallToken(t,n)}catch(t){
this._logger.warn("Unable to provide id_token_hint for end session request, using standard token.",t),i=e._idToken}}if(i||!this.isEndSessionIdTokenHintRequired()){
let e=h.getString("uu_app_oidc_post_logout_redirect_uri");e=e?n.toFullAppUrl(e):this._defaultRedirectUri,t+=t.includes("?")?"&":"?",t+="post_logout_redirect_uri="+encodeURIComponent(e),
i&&(t+="&id_token_hint="+encodeURIComponent(i))}
let l=h.getString(f+this._serviceName+"_logout_type")||S.type[this._serviceName],c=h.getNumber(f+this._serviceName+"_logout_popup_width")||S.popupWidth[this._serviceName]||m,u=h.getNumber(f+this._serviceName+"_logout_popup_height")||S.popupHeight[this._serviceName]||y,d="main"===l?o:"popup"===l?s:r
;return this._logger.debug(`Invoking end session request: ${t}`),new Promise(((e,i)=>{new d({width:c,height:u,url:t,onResult:t=>{t instanceof Error?i(t):e()}}).render()}))}
sendRequest(e,t=r,i=this.getAuthResponseFromCallback.bind(this)){let n,o=new Promise(((r,o)=>{
let a=h.getNumber(f+this._serviceName+"_login_popup_width")||w.width[this._serviceName]||m,c=h.getNumber(f+this._serviceName+"_login_popup_height")||w.height[this._serviceName]||y;n=new t({width:a,
height:c,url:e,onResult:e=>{if(e instanceof Error)return o(e);if(!1===e)return o(new u("User refused to log in."));if(e===s.ERROR_POPUP_BLOCKED)return o(new u("Login failed due to popup blocking."))
;let t=i(e);if(t.error){let e,{error:i,error_description:n,uu_oidc_error_id:s,uu_oidc_error_code:r,...a}=t,c=r||i,h=n||"Authentication error: "+i
;e=c&&c.match(/(interaction|login|account_selection|consent)_required/i)||h&&h.match(/interaction required/i)?new l(h):new u(h),e.code=c,s&&(e.id=s),Object.assign(e,a),o(e)}else r(t)}}),n.render()}))
;return o.uiComponent=n,o}async _loadCheckSessionIframe(){await n.domReady;let e=await this._oauthClient.getCheckSessionIframeUri();if(e)return new Promise((t=>{
this._logger.debug(`Creating iframe with check_session_iframe endpoint URL: ${e}`);let i=document.createElement("iframe")
;i.style.cssText="position: absolute;top: -300px; left: -300px; width: 200px; height: 200px; opacity: 0;",i.tabIndex="-1",i.onload=()=>{
this._iframeTrustedOrigin=e.match(/^(https?:\/\/[^\/]+).*$/)[1]||null,this._checkSessionIframe=i,window.addEventListener("message",this._onMessage.bind(this)),t()},i.src=e,document.body.appendChild(i)
}));this._logger.warn(`The OpenID Connect server ${this._oauthClient.getServiceUri()} doesn't support check_session_iframe endpoint.`)}_onMessage(e){
this._logger.debug(`Received message from ${e.origin}: ${e.data}`),
this._checkSessionIframe&&e.source===this._checkSessionIframe.contentWindow&&e.origin===this._iframeTrustedOrigin?(this._logger.debug(`Propagating session state "${e.data}" to listeners.`),
this._runningCheckSessionResolve&&this._runningCheckSessionResolve(e.data),this._runningCheckSessionResolve=null,
this._runningCheckSessionPromise=null):this._logger.debug(`Message "${e.data}" from ${e.origin} is not from check session iframe, ignoring.`)}_addUriParams(e,t){let i=[];for(let e in t){let n=t[e]
;null!=n&&i.push(encodeURIComponent(e)+"="+encodeURIComponent(n+""))}return e+"&"+i.join("&")}}},72:(e,t,i)=>{"use strict";const{Config:n}=i(498),s=i(805)
;let r=n.getNumber("uu_app_oidc_unmet_access_policy_notification_delay")||3e3,o=null,a=null;e.exports=class{constructor(e,t=null){this._next=e,this._options=t||{}}async invoke(e,t=null){try{
return await this._next.invoke(e,t)}catch(e){throw"uu-app-oidc/verifyAccessPolicy/untrustedSession"===e.code&&e.paramMap&&this._recordError(e),e}}_recordError(e){
let t=this._getErrorReasonMap(),{maxAuthenticationAge:i,supportedAcrValues:n,deniedAuthenticationRealms:s}=e.paramMap
;null!=i&&(null==t.maxAuthenticationAge||t.maxAuthenticationAge>i)&&(t.maxAuthenticationAge=i),
null!=n&&(null==t.supportedAcrValues?t.supportedAcrValues=n:t.supportedAcrValues=t.supportedAcrValues.filter((e=>n.includes(e)))),
s&&(null==t.deniedAuthenticationRealms?t.deniedAuthenticationRealms=s:s.forEach((e=>{t.deniedAuthenticationRealms.includes(e)||t.deniedAuthenticationRealms.push(e)})))}_getErrorReasonMap(){
return o||(o={},a=setTimeout((()=>{s._triggerEvent("untrustedSession",{...o}),o=null,a=null}),r),o)}}},46:(e,t,i)=>{
const{Config:n,Digest:s}=i(498),{LoggerFactory:r}=i(732),o=i(782),a=i(477),l=i(448),c="uu_app_oidc_providers_",u=["none","low","medium","high","veryHigh"],h=["none","low","standard","high","veryHigh"],d=r.get("uuapp.oidc.Session"),_=function(e,t){
let i=e.toString().split("/"),n=t.toString().split("/");if(n.length>i.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==i[e])return!1;return!0};class p{static from(e,t,i,r,o){
return e?(e._appBaseUri=l.appBaseUri.replace(/\/$/,""),e._authnCtx=t||null,e.getAuthenticationContext=function(){return this._authnCtx}.bind(e),e._expiresAt=i||null,e.getExpiresAt=function(){
return this._expiresAt}.bind(e),e._state=r||null,e.getState=function(){return this._state}.bind(e),Object.defineProperty(e,"_authnService",{get:()=>o,enumerable:!1}),
e._origGetCallTokenScope=e.getCallTokenScope.bind(e),e.getCallTokenScope=function(e=null,t={}){if(!e)return null;let i;return i=_(e,this._appBaseUri)?this._appBaseUri:this._origGetCallTokenScope(e,t),
i}.bind(e),e.getCallToken=async function(t=null,i={}){let s;if(null!=t&&_(t,this._appBaseUri)){let e=i?i.callTokenType:null;if(!e){let t=`${this._configPrefix}call_token_type`;e=n.getString(t)}
"idToken"===e?s=this._idToken:"accessToken"===e?s=this._accessToken:e||(s=this._idToken||this._accessToken)}else s=await a.getCallToken(e,t,i);if(s){
return!0===(!!i&&i.excludeAuthenticationType)?s:`Bearer ${s}`}return null}.bind(e),e.actAs=async function(e,t=null,i={}){return null==t||"string"==typeof t||Array.isArray(t)||(i=t,t=null),delete(i={
...i}).prompt,i.loginHint=e,null==i.usePopup&&(i.usePopup=!1),this.removeFromCache(),await this._authnService.authenticate(i,t)},e.close=async function(){if(this.removeFromCache(),
this._authenticated)try{await e._authnService._authnFlow.endSession(e),"function"==typeof this._onCloseListener&&this._onCloseListener(this),e._authenticated=!1,e._idToken=null,e._accessToken=null
}catch(t){d.warn("Logout finished but session might not be cancelled - server responded with unexpected callback.",t),e._authnService.checkSession()}}.bind(e),e.matches=function(e,t){let i,n;if(e){
let t=this._supportedAcrValues,n=e.toString();t.includes("medium")?n=n.replace("standard","medium"):t.includes("standard")&&(n=n.replace("medium","standard"));let s=n.split(" "),r=[];s.forEach((e=>{
let i=Number(e);isNaN(i)&&(i=t.indexOf(e),i<0&&(i=h.indexOf(e)),i<0&&(i=u.indexOf(e))),i>=0&&r.push(i)})),i=Math.min(...r)}t&&(n=t);try{return this.assertTrustiness({
minAuthenticationLevelOfAssurance:i,maxAuthenticationAge:n}),!0}catch(e){return!1}}.bind(e),e.storeToCache=function(e=null){let t={attributes:this._attributes,acrValues:this._supportedAcrValues,
idToken:this._idToken,acccessToken:this._accessToken,authnCtx:this._authnCtx,expiresAt:this._expiresAt,state:this._state,authConstraints:this._authConstraints,userAgent:s.sha1(navigator.userAgent)
},i=`${c}${this._serviceName}_session`;e&&(i+=`_${s.sha1(e)}`),sessionStorage.setItem(i,JSON.stringify(t))}.bind(e),e.removeFromCache=function(){let e=`${c}${this._serviceName}_session`
;Object.keys(sessionStorage).forEach((t=>{t&&t.toString().startsWith(e)&&sessionStorage.removeItem(t)}))}.bind(e),e):e}static loadFromCache(e,t=null){let i=e.getServiceName(),r=`${c}${i}_session`
;t&&(r+=`_${s.sha1(t)}`);let a=sessionStorage.getItem(r);if(!a)return null;try{a=JSON.parse(a);let t=Date.now()/1e3,l=a.attributes.exp,c=n.getNumber("uu_app_oidc_providers_"+i+"_token_refresh_leeway")
;if(null==c&&(c=300),a.expiresAt&&a.expiresAt<=t||l&&l-c<=t)return d.warn(`Cached session for ${i} is expired.`),sessionStorage.removeItem(r),null
;if(a.userAgent!=s.sha1(navigator.userAgent))return d.warn(`UserAgent does not match on cached session for service ${i}.`),sessionStorage.removeItem(r),null
;let u=e._oauthClient,h=new o(i,u,a.acrValues,a.attributes,a.idToken,a.acccessToken);return h._authConstraints=a.authConstraints,p.from(h,a.authnCtx,a.expiresAt,a.state,e)}catch(e){
return d.error(`Unable to restore cached session for ${i}.`,e),null}}}e.exports=p},624:(e,t,i)=>{"use strict"
;const{Config:n,LruCache:s,Base64:r}=i(498),{AppClient:o,PerflogHandler:a,RemoteErrorHandler:l,TransformParametersHandler:c,ApplicationError:u}=i(44),{LoggerFactory:h}=i(732),d=i(30),_=i(448),p=[a,l,c],g=new s({
maxSize:256,maxAge:36e5,localStorageKey:"uu_app_oidc_cache_client_id"}),f=h.get("uuapp.oidc.ClientCredentialsProvider"),m="uu_app_oidc_providers_",y=Math.random().toString(16).substring(2,10);class w{
static async getClientId(e){let t=r.encode(`${_.appBaseUri}:${e}`),i=g.get(t)||n.getString(`${m}${e}_client_id`);if(!i){let s=null;try{let t={serviceName:e},n={interceptors:p}
;s=await o.get(`${_.appBaseUri}oidc/getClientId`,t,n),i=s.data.clientId}catch(t){if(!(t instanceof u&&404===t.status))throw t
;f.warn('Backend does not provide "oidc/getClientId" endpoint and custom configuration of clientId is not available. Using unregistered client.'),
i=n.get(`${m}${e}_unregistered_client_id`)||`uu-oidc:unregistered-client:${y}`}g.set(t,i)}return this._clientIds[t]=i,i}static getClientIdSync(e){
let t=r.encode(`${_.appBaseUri}:${e}`),i=this._clientIds[t];if(!i)throw new d("Asynchronous method getClientId or getClientCredentials must be invoked prior to synchronous invocation");return i}
static async getClientCredentials(e){return{client_id:await this.getClientId(e),client_secret:null}}static getClientCredentialsSync(e){return{client_id:this.getClientIdSync(e),client_secret:null}}}
w._clientIds={},e.exports=w},585:(e,t,i)=>{"use strict"
;const{AppClient:n}=i(44),s=i(624),{AuthenticationError:r}=i(460),o=i(475),a=i(8),l=i(668),c=location.href.startsWith("about:")&&window.frameElement?parent:window,u=new RegExp("uu.app.csrf=([^;]+)")
;e.exports=class extends a{constructor(e,t,i,s){super(e,t,i),this._oauthClient=e,this._serviceName=t,this._redirectUri=i,this._appBaseUri=s,this._client=new n,this._doOnlyLocalSessionCheck=!1}
async restoreSession(e,t){let i=sessionStorage.getItem("uu_app_oidc_auth_cb");sessionStorage.removeItem("uu_app_oidc_auth_cb");let n=await this._restoreSessionViaAppSession(e,t)
;return n&&this._assertConstraints(n.claims,e,i)||i||(n=await this._resotreSessionViaIdpSession(e,t)),n||(await this._oauthClient.getMetadata(),await s.getClientId(this._serviceName),
this._throwInteractionRequired()),n}async checkSession(e){let t;return this._doOnlyLocalSessionCheck?this._isSessionValid()?"unchanged":"changed":(t=await super.checkSession(e),
"unknown"===t&&(this._logger.warn("Switching global session check to application session check due to blocked thirdparty cookies."),this._doOnlyLocalSessionCheck=!0,t="unchanged"),t)}
async refreshSession(e,t=null){this._isSessionValid()||this._throwInteractionRequired();let i,n=Date.now();try{i=(await this._client.post(this._appBaseUri+"oidc/extendSession")).data}catch(e){
if(!e.status||401!==e.status)throw e;this._throwInteractionRequired(e)}this._assertConstraints(i,e,!0)
;let s=n+1e3*i.session_info.session_expires_in,r=i.session_info.session_state,o=i.session_info.client_id;return delete i.session_info,delete i.uuAppErrorMap,{claims:i,globalSessionExpiresAt:s,
globalSessionState:r,clientId:o}}async getCallToken(e,t=null){let i=(await this._client.post(this._appBaseUri+"oidc/grantCallToken",{scope:t})).data,n=Date.now()+1e3*i.expires_in;return{
idToken:i.id_token,accessToken:i.access_token,expireAt:n}}async _restoreSessionViaAppSession(e,t){if(this._logger.debug("Trying to restore session based on existing application session."),
!this._isSessionValid())return this._logger.debug("Application session not found."),null;let i,n=Date.now();try{i=(await this._client.get(this._appBaseUri+"oidc/introspect",{_:Date.now()})).data
}catch(e){return this._logger.debug("Restoring of session based on existing application session failed.",e),null}if(!i||!i.session_info)return this._logger.debug("Application session not found."),null
;let s=n+1e3*i.session_info.session_expires_in,r=i.session_info.session_state,o=i.session_info.client_id;delete i.session_info,delete i.uuAppErrorMap
;let a=e.acrValues||this._defaultAcrValues,l=e.maxAge||this._defaultMaxAge,c=sessionStorage.getItem("uu_app_oidc_auth_ctx");return c&&(c=JSON.parse(c),
sessionStorage.removeItem("uu_app_oidc_auth_ctx")),{claims:i,idToken:null,accessToken:null,authenticationContext:c,globalSessionExpiresAt:s,globalSessionState:r,clientId:o,scope:t,acrValues:a,maxAge:l
}}async _resotreSessionViaIdpSession(e,t){return this._logger.debug("Restoring session by redirection to configured identity provider."),await this._oauthClient.getMetadata(),e={...e,usePopup:!1,
prompt:"none",noIframe:!0},"forced"===o.getRestoreSessionOnLoad()&&delete e.prompt,sessionStorage.setItem("uu_app_oidc_auth_referrer",document.referrer),this.authenticate(e,t)}
async _assertConstraints(e,t,i){let n=t.acrValues||this._defaultAcrValues;if(n&&!n.includes(e.acr)){if(!i)return!1;this._throwInteractionRequired()}let s=t.maxAge||this._defaultMaxAge
;if(s&&1e3*(e.auth_time+s)<Date.now()){if(!i)return!1;this._throwInteractionRequired()}}_isSessionValid(){let e=(u.exec(c.document.cookie)||[])[1];if(!e)return!1;let t=e.split(".")
;return 3!==t.length||1e3*Number(t[0])>Date.now()}_throwInteractionRequired(e=null){
let t=new l("Authentication Request cannot be completed without displaying a user interface for End-User interaction.",e);throw t.code="interaction_required",t}}},8:(e,t,i)=>{"use strict"
;const{AuthenticationError:n}=i(460),{AppClient:s}=i(44),r=i(475),o=i(16),a=location.href.startsWith("about:")&&window.frameElement?parent:window,l=new RegExp("uu.app.csrf=([^;]+)")
;e.exports=class extends r{constructor(e,t,i,n){super(e,t,i),this._oauthClient=e,this._serviceName=t,this._redirectUri=i,this._appBaseUri=n,this._client=new s,this._implicitFlow=new o(e,t,i,n)}
getResponseType(){return"code"}createAuthState(e=null,t=null){let i=super.createAuthState(e,t);return i.redirectUri=this._redirectUri,i}async restoreSession(e,t=null){
let i=sessionStorage.getItem("uu_app_oidc_auth_cb");return sessionStorage.removeItem("uu_app_oidc_auth_cb"),e={prompt:"none",...e},
i||"forced"!==r.getRestoreSessionOnLoad()||(await this._oauthClient.getMetadata(),delete e.prompt,e.usePopup=!1,sessionStorage.setItem("uu_app_oidc_auth_referrer",document.referrer)),
super.restoreSession(e,t)}authenticate(e,t=null){
let i=super.authenticate(e,t),n=i.then((({authResponse:e,state:t,nonce:i,scope:n,acrValues:s,maxAge:r,clientId:o})=>this._processAuthResponse(e,t,i,n,s,r,o)));return n.uiComponent=i.uiComponent,n}
getAuthResponseFromCallback(e){let t={};return e.replace(/^[^?#]*[?#]?/,"").replace(/#/,"&").split(/&/).filter(Boolean).forEach((e=>{
let i=e.indexOf("="),n=decodeURIComponent((-1==i?e.substr(0):e.substr(0,i)).replace(/\+/g," ")),s=decodeURIComponent((-1==i?"":e.substr(i+1)).replace(/\+/g," "));t[n]=s})),t}refreshSession(e,t=null){
return e={prompt:"none",usePopup:!1,...e},super.refreshSession(e,t)}getCallToken(e,t=null){return this._implicitFlow.getCallToken(e,t)}getEndSessionUri(){
let e=this._appBaseUri+"oidc/logout",t=(l.exec(a.document.cookie)||[])[1];return t&&(e+=`?csrf_token=${encodeURIComponent(t)}`),e}isEndSessionIdTokenHintRequired(){return!1}
async _processAuthResponse(e,t,i,n,s,r,o){let a=Date.now();await this._validateAuthResponse(e,t,i);let l=(await this._client.get(this._appBaseUri+"oidc/introspect",{_:Date.now()})).data
;delete l.session_info,delete l.uuAppErrorMap;let{session_expires_in:c,session_state:u}=e,h=c?a+1e3*c:null;sessionStorage.removeItem("uu_app_oidc_auth_cb")
;let d=sessionStorage.getItem("uu_app_oidc_auth_ctx");return d&&(d=JSON.parse(d),sessionStorage.removeItem("uu_app_oidc_auth_ctx")),{claims:l,idToken:null,accessToken:null,authenticationContext:d,
globalSessionExpiresAt:h,globalSessionState:u,clientId:o,scope:n,acrValues:s,maxAge:r}}async _validateAuthResponse(e,t,i){
if(t&&e.state!==t)throw new n("Invalid 'state' in received authorization response. Expected "+t+" but got "+e.state+". Response: "+JSON.stringify(e))}}},477:(e,t,i)=>{"use strict"
;const{Config:n}=i(498),{LoggerFactory:s}=i(732),r=i(448);class o{static async getCallToken(e,t,i){let n=e.getServiceName();if(!n||!e._oauthClient)return null
;let s=`${n}|${t=t?t.toString():""}`,r=this._providers[s];r||(r=new this(e,t),this._providers[s]=r);let o=e.getAttribute("sub"),a=e.getAttribute("auth_time");return r._getCallToken(o,a,i)}
constructor(e,t){this._serviceName=e.getServiceName(),this._callUri=t,this._configPrefix=`uu_app_oidc_providers_${this._serviceName}_`,
this._tokenTimeLeeway=n.getNumber(`${this._configPrefix}token_time_leeway`,!1)||300,this._logger=s.get("uuapp.oidc.ExternalCallTokenProvider"),this._authnFlow=e._authnService._authnFlow,
this._runningPromise=null,this._idToken=null,this._accessToken=null,this._expireAt=null,this._baseUri=null,this._sub=null,this._authTime=null}async _getCallToken(e,t,i={}){if(!this._isValid(e,t)){
if(!this._runningPromise){this._logger.debug(`Requesting new call token for ${this._callUri}`);let e={prompt:"none",usePopup:!1}
;this._authnFlow.getCallToken?this._runningPromise=this._authnFlow.getCallToken(e,this._callUri):this._runningPromise=this._authnFlow.authenticate(e,this._callUri)}try{
let{idToken:i,accessToken:n,claims:s,expireAt:o}=await this._runningPromise;this._idToken=i,this._accessToken=n,this._expireAt=o||1e3*s.exp,this._baseUri=r.appBaseUri,this._sub=e,this._authTime=t,
this._logger.debug(`Call token for ${this._callUri} received`)}catch(e){return this._logger.error(`Unable to get call token for ${this._callUri}`,e),null}finally{this._runningPromise=null}}
let s=null,o=i?i.callTokenType:null;if(!o){let e=`${this._configPrefix}call_token_type`;o=n.getString(e)}
return"idToken"===o?s=this._idToken:"accessToken"===o?s=this._accessToken:o||(s=this._idToken||this._accessToken),s}_isValid(e,t){
return this._baseUri===r.appBaseUri&&this._sub===e&&this._authTime===t&&!this._isExpired()}_isExpired(){return!this._expireAt||Date.now()>=this._expireAt-2*this._tokenTimeLeeway}}o._providers={},
e.exports=o},16:(e,t,i)=>{"use strict";const{AuthenticationError:n}=i(460),s=i(475);e.exports=class extends s{constructor(e,t,i,n){super(e,t,i),this._oauthClient=e,this._serviceName=t}
getResponseType(){return"id_token token"}async restoreSession(e,t=null){let i=sessionStorage.getItem("uu_app_oidc_auth_cb");return sessionStorage.removeItem("uu_app_oidc_auth_cb"),e={prompt:"none",
...e},i||"forced"!==s.getRestoreSessionOnLoad()||(await this._oauthClient.getMetadata(),delete e.prompt,e.usePopup=!1,sessionStorage.setItem("uu_app_oidc_auth_referrer",document.referrer)),
super.restoreSession(e,t)}authenticate(e,t=null){
let i=super.authenticate(e,t),n=i.then((({authResponse:e,state:t,nonce:i,scope:n,acrValues:s,maxAge:r,clientId:o})=>this._processAuthResponse(e,t,i,n,s,r,o)));return n.uiComponent=i.uiComponent,n}
getAuthResponseFromCallback(e){let t={};return e.replace(/^[^#]*#?/,"").split(/&/).forEach((e=>{
let i=e.indexOf("="),n=decodeURIComponent((-1==i?e.substr(0):e.substr(0,i)).replace(/\+/g," ")),s=decodeURIComponent((-1==i?"":e.substr(i+1)).replace(/\+/g," "));t[n]=s})),t}refreshSession(e,t=null){
return e={prompt:"none",usePopup:!1,...e},super.refreshSession(e,t)}getEndSessionUri(){return this._oauthClient.getEndSessionUriSync()}async _processAuthResponse(e,t,i,n,s,r,o){
let a=Date.now(),l=await this._validateAuthResponse(e,t,i),{id_token:c,access_token:u,session_expires_in:h,session_state:d}=e,_=h?a+1e3*h:null;sessionStorage.removeItem("uu_app_oidc_auth_cb")
;let p=sessionStorage.getItem("uu_app_oidc_auth_ctx");return p&&(p=JSON.parse(p),sessionStorage.removeItem("uu_app_oidc_auth_ctx")),{claims:l,idToken:c,accessToken:u,authenticationContext:p,
globalSessionExpiresAt:_,globalSessionState:d,clientId:o,scope:n,acrValues:s,maxAge:r}}async _validateAuthResponse(e,t,i){
if(t&&e.state!==t)throw new n("Invalid 'state' in received authorization response. Expected "+t+" but got "+e.state+". Response: "+JSON.stringify(e))
;if(this._isAuthResponseExpired(e))throw new n("Token expired "+JSON.stringify(e));let s=await this._oauthClient.parseToken(e.id_token,"idToken")
;if(i&&s.nonce!==i)throw new n("Invalid nonce in ID token claims. Expected "+i+" but got "+s.nonce);return s}_isAuthResponseExpired(e){var t=(new Date).getTime()/1e3,i=!1
;return e.issued_at||(e.issued_at=t),e.expires_at&&(i=i||e.expires_at<t-60),e.expires_in&&e.issued_at&&(i=i||Number(e.expires_in)+Number(e.issued_at)<t-60),i}}},367:e=>{class t{static wrapClass(e,i){
let n;return Object.defineProperty(e,"currentSession",{get:()=>(n||(n=t.initG01Session(e,i)),n)}),Object.defineProperty(e,"initComplete",{get:()=>i._onPageLoadFinished}),
Object.defineProperty(e,"initPromise",{get:()=>i._onPageLoad().then((s=>(n||(n=t.initG01Session(e,i)),n)))}),e}static initG01Session(e,t){let i=e._createEmptySession()
;Object.defineProperty(i,"initComplete",{get:()=>t._onPageLoadFinished}),Object.defineProperty(i,"initPromise",{get:()=>t._onPageLoad().then((()=>i))});let n=null;const s=()=>n||t.getCurrentSession()
;i.getIdentity=function(){let e=s(),t=e.getIdentity();return t?(t.id=e.getAttribute("sub"),t.name=t.getName(),t.email=e.getAttribute("email"),t.uuIdentity=t.getUuIdentity(),
t.levelOfAssurance=t.getLevelOfAssurance(),t.loginLevelOfAssurance=e.getAuthenticationLevelOfAssurance(),t):t},i.getClaims=function(){return s()._attributes},i.getCallToken=function(e=null,t={}){
if("string"==typeof e||Array.isArray(e))return s().getCallToken(e,t);{let e=s();return{token:e._idToken||e._accessToken,tokenType:e._idToken?"Bearer":null}}},i.getCallTokenScope=function(e=null,t={}){
return s().getCallTokenScope(e,t)},i.isExpiring=function(){return t.isSessionExpiring()},i.isAuthenticated=function(){return s().isAuthenticated()},i.login=function(e){let n={...e},s={}
;return n.access_token&&"urn:ietf:params:oauth:token-type:jwt-uuos8"===n.token_type_hint&&(s={os8Token:n.access_token},delete n.access_token,delete n.token_type_hint),Object.assign(s,n),
t.authenticate(s).then((()=>i))},i.logout=function(){return s().close()};let r={};i.addListener=function(s,o){"identityChange"===s&&(s="sessionChanged");let a=t.addListener(s,(({type:t,data:s})=>{
let r=n;s instanceof e&&(n=s);try{let n=t,r=s instanceof e?i:s;return"sessionChanged"===t&&(n="identityChange",r=i.getIdentity()),o({type:n,data:r})}finally{n=r}})),l=r[s];return l||(l=r[s]=new Map),
l.set(o,a),a},i.removeListener=function(e,t){"identityChange"===e&&(e="sessionChanged");let i=r[e],n=i?i.get(t):null;return!!n&&(i.delete(t),n())};let o=new Map
;return i.addIdentityChangeListener=function(e){let t=i.addListener("identityChange",(t=>e(t.data)));return o.set(e,t),t},i.removeIdentityChangeListener=function(e){let t=o.get(e)
;return!!t&&(o.delete(e),t())},i.getAuthenticationContext=function(){return s().getAuthenticationContext()},i._unwrap=function(){return s()},i}}e.exports=t},166:(e,t,i)=>{"use strict"
;const{AuthenticationError:n}=i(460),s=i(624),r=i(16);e.exports=class extends r{constructor(e,t,i){super(e,t,i,null)}async authenticate(e,t=null){let{os8Token:i}=e
;if(!i)throw new n("Authentication using Os8Flow requires option 'os8Token' passed to the authentication call.");let r=await s.getClientId(this._serviceName),o={subject_token:i,
response_type:"id_token",client_id:r,redirect_uri:this._redirectUri
},a=Object.keys(o).filter((e=>null!=o[e])).map((e=>encodeURIComponent(e)+"="+encodeURIComponent(o[e]+""))),l=this._oauthClient.getServiceUri().replace(/\/*$/,"/")+"exchangeOs8Token?"+a.join("&"),c=await this.sendRequest(l)
;return await this._processAuthResponse(c,null,null,t,null,null,r)}}},614:(e,t,i)=>{"use strict";const{LoggerFactory:n}=i(732);e.exports=class{constructor(e,t,i,s){this._authnFlow=e,this._enabled=!0,
this._sessionCheckInterval=t,this._clientId=i,this._getSessionStateFn=s,this._listeners=[],this._unknownStateListeners=[],this._notifyUnknownState=!0,
this._logger=n.get("uuapp.oidc.internal.SessionStateChangeNotifier"),this._stateCheckInterval=setInterval(this._checkState.bind(this),1e3*this._sessionCheckInterval)}enable(){this._enabled=!0}
disable(){this._enabled=!1}onStateChange(e){return this._listeners.push(e),()=>{var t=this._listeners.indexOf(e);return-1!=t&&this._listeners.splice(t,1),-1!=t}}onStateUnknown(e){
return this._unknownStateListeners.push(e),()=>{var t=this._unknownStateListeners.indexOf(e);return-1!=t&&this._unknownStateListeners.splice(t,1),-1!=t}}destroy(){this._destroyed||(this._destroyed=!0,
this._stateCheckInterval&&clearInterval(this._stateCheckInterval),delete this._stateCheckInterval,this._listeners=[],this._unknownStateListeners=[],this._notifyUnknownState=!0)}async _checkState(){
if(!this._enabled)return;let e=this._getSessionStateFn();if(!e)return;let t=this._clientId+" "+e;this._logger.debug("Checking session state.");let i=await this._authnFlow.checkSession(t)
;"changed"===i?(this._logger.debug(`Received session state change notification (message: '${i}').`),this._notifyUnknownState=!0,
this._listeners.forEach((e=>e()))):"unknown"===i?(this._logger.debug(`Received session state change notification (message: '${i}').`),
this._notifyUnknownState&&(this._logger.debug(`Propagating info about '${i}' session state.`),this._unknownStateListeners.forEach((e=>e())),this._notifyUnknownState=!1)):this._notifyUnknownState=!0}}
},752:e=>{var t="uuOidcCallbackFn";"undefined"==typeof window||window[t]||(window[t]=function(e,i,n){for(var s=window[t].loginWindows,r=0;r<s.length;++r){var o=s[r]
;if(o.state.loginWindow==i)return n&&sessionStorage.setItem("uu_app_oidc_auth_ctx","object"==typeof n?JSON.stringify(n):n),void o.component.finalize(e)}
console.warn("["+(new Date).toISOString()+"]  WARN uuapp.oidc.CallbackHandler: Received unexpected callback from window",i,"Passed result was:",e,"Ignoring the callback.")},window[t].loginWindows=[]),
e.exports={registerForCallback(e,i){window[t].loginWindows.push({component:e,state:i})},unregisterForCallback(e){for(var i=window[t].loginWindows,n=0;n<i.length;++n)if(i[n].component===e){
i.splice(n,1);break}}}},448:e=>{
let t=new Function("try {return this===window;}catch(e){ return false;}")()?"interactive"===document.readyState||"complete"===document.readyState?Promise.resolve():new Promise((e=>{
document.addEventListener("DOMContentLoaded",e,!1)})):Promise.resolve()
;const i=location.href.startsWith("about:")&&window.frameElement?parent:window,n=i.document.querySelector("base"),s=i.location.protocol+"//"+i.location.host+(n&&n.getAttribute("data-uu-app-base")||"/"),r=(new RegExp("uu.app.cbu=([^;]+)").exec(i.document.cookie)||[])[1]
;e.exports={domReady:t,window:i,baseElement:n,appBaseUri:s,canonicalAppBaseUri:r,toFullAppUrl:function(e){let t=i.document.createElement("a")
;return t.href=e&&e.match(/^[a-z]+:/i)?e:s+(e?e.replace(/^\/+/,""):""),t.href.toString()}}},604:(e,t,i)=>{const n=i(752);e.exports=function(e){var t=Object.assign({},e),i={iframe:null}
;Object.defineProperty(i,"loginWindow",{get:function(){try{return null!=i.iframe?i.iframe.contentWindow:null}catch(e){}return null}}),n.registerForCallback(this,i),this.finalize=function(e){
this.finalize=function(){},this.destroy(),t.onResult&&t.onResult(e)}.bind(this),this.render=function(){if(!i.iframe){
let e=new Error("Server did not provide expected callback HTML page. Check if requested URL "+t.url+" contains proper redirect parameter. If so, look also into network console for possible callback response error.")
;i.iframe=document.createElement("iframe"),i.iframe.style.cssText="position: absolute;top: -300px; left: -300px; width: 200px; height: 200px; opacity: 0;",i.iframe.src=t.url,
i.iframe.onload=()=>this.finalize(e),i.iframe.onerror=()=>this.finalize(e),document.body.appendChild(i.iframe),t.timeout&&(this._timeout=setTimeout((()=>{
this.finalize(new Error("OIDC iframe didn't receive callback within "+t.timeout+"s."))}),1e3*t.timeout))}},this.destroy=function(){
i.iframe&&i.iframe.parentNode&&i.iframe.parentNode.removeChild(i.iframe),this.destroy=function(){},this._timeout&&clearTimeout(this._timeout),n.unregisterForCallback(this)}}},119:e=>{
e.exports=function(e){var t=Object.assign({},e);this.render=function(){location.href=t.url,setTimeout((()=>{t.onResult(new Error("Login aborted"))}),1e4)}}},605:(e,t,i)=>{const n=i(752),s=function(e){
var t=Object.assign({},e),i={loginWindow:null,closeCheckInterval:null};n.registerForCallback(this,i),this.finalize=function(e){this.finalize=function(){},this.destroy(),t.onResult&&t.onResult(e)
}.bind(this);var r=function(){i.loginWindow&&i.loginWindow.closed&&this.finalize(!1)}.bind(this);this.render=function(){if(!i.loginWindow){var e={width:t.width||599,height:t.height||600}
;e.left=(screen.availWidth-e.width)/2+(screen.availLeft||0),e.top=(screen.availHeight-e.height)/2+(screen.availTop||0),
i.loginWindow=window.open(t.url,"_blank",`toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no,width=${e.width},height=${e.height},top=${e.top},left=${e.left}`),
i.loginWindow?i.closeCheckInterval=setInterval(r.bind(this),200):Promise.resolve().then((()=>this.finalize(s.ERROR_POPUP_BLOCKED)))}},this.focus=function(){i.loginWindow&&i.loginWindow.focus()},
this.destroy=function(){i.loginWindow&&!i.loginWindow.closed&&i.loginWindow.close(),i.closeCheckInterval&&clearInterval(i.closeCheckInterval),this.destroy=function(){},n.unregisterForCallback(this)}}
;s.ERROR_POPUP_BLOCKED="POPUP_BLOCKED",e.exports=s},44:(e,t,i)=>{e.exports=i(729).AppClient},460:(e,t,i)=>{e.exports=i(729).Authentication},732:(e,t,i)=>{e.exports=i(729).Logging},706:(e,t,i)=>{
e.exports=i(729).Uri},498:(e,t,i)=>{e.exports=i(729).Util},357:(e,t,i)=>{"use strict"
;const{Config:n,BaseError:s}=i(498),{AuthenticationService:r}=i(460),o="uu_app_oidc_providers_",a="uu_app_oidc_allow_audience_alias",l="uu_app_oidc_disable_webcrypto_api",c="oidcg01",u="oidcg02"
;e.exports=class{static load(e,t=!0){t&&(Object.keys(e._providers).forEach((e=>{delete r._realizations[e]})),e._providers={},e._primaryProvider=null),this.loadOidcg02(e,t),this.loadOidcg01(e,t)
;let i=null;if("undefined"==typeof window)i=n.toJSON();else{let e=n.chain._sources[0];i=Object.assign(e?e._data:{},n.chain._custom)}let h=Object.keys(i);for(let s=0;s<h.length;s+=1){
let r=h[s],d=i[r],_=new RegExp(`^${o}(.*)_uri$`).exec(r);if(!_)continue;let p=_[1],g=`${o}${p}`;if(p===c||p===u)continue;let f=n.getBoolean(`${g}_enabled`,!1);if("boolean"==typeof f&&!f)continue
;p=n.getString(`${g}_name`,!1)||p;let m={serviceUri:d,verifySsl:n.getBoolean(`${g}_verify_ssl`,!1),accessTokenPattern:n.getString(`${g}_access_token_pattern`,!1),
refreshTokenPattern:n.getString(`${g}_refresh_token_pattern`,!1),verifyAudience:n.getBoolean(`${g}_verify_audience`,!1),allowAudienceAlias:n.getBoolean(a,!1),
tokenCacheSize:n.getNumber(`${g}_token_cache_size`,!1),tokenTimeLeeway:n.getNumber(`${g}_token_time_leeway`,!1),discoveryPath:n.getNumber(`${g}_discovery_path`,!1),
discoveryCacheTtl:n.getNumber(`${g}_discovery_cache_ttl`,!1),jwksCacheTtl:n.getNumber(`${g}_jwks_cache_ttl`,!1),defaultScope:n.getString(`${g}_default_scope`,!1),
perflogEnabled:n.getBoolean(`${g}_perflog_enabled`,!1),callTokenType:n.getString(`${g}_call_token_type`),callTokenIntrospectAge:n.getNumber(`${g}_call_token_introspect_age`),
issuer:n.getString(`${g}_issuer`),oauthRealization:n.getString(`${g}_oauth_realization`),disableWebcryptoApi:n.getBoolean(l,!1),force:t};e.create(p,m)}
let d=n.getString("uu_app_oidc_primary_provider",!1);if(d){if(!e._providers[d])throw new s(`Cannot set primary provider to ${d}. Service does not exits or is not enabled.`);e._primaryProvider=d}}
static loadOidcg02(e,t=!1){let i=`${o}${u}`,s=n.getBoolean(`${i}_enabled`,!1);if("boolean"!=typeof s&&(s=true),!s)return;let r=n.getString(`${i}_uri`,!1),c=n.getBoolean(`${i}_verify_audience`,!1)
;null==c&&(c=true);let h={force:t,serviceUri:r||"https://uuidentity.plus4u.net/uu-oidc-maing02/bb977a99f4cc4c37a2afce3fd599d0a7/oidc",verifySsl:n.getBoolean(`${i}_verify_ssl`,!1),
accessTokenPattern:n.getString(`${i}_access_token_pattern`,!1)||"^at.*",refreshTokenPattern:n.getString(`${i}_refresh_token_pattern`,!1)||"^rt.*",verifyAudience:c,
allowAudienceAlias:n.getBoolean(a,!1),tokenCacheSize:n.getNumber(`${i}_token_cache_size`,!1),tokenTimeLeeway:n.getNumber(`${i}_token_time_leeway`,!1),
discoveryCacheTtl:n.getNumber(`${i}_discovery_cache_ttl`,!1),jwksCacheTtl:n.getNumber(`${i}_jwks_cache_ttl`,!1),defaultScope:n.getString(`${i}_default_scope`,!1),
perflogEnabled:n.getBoolean(`${i}_perflog_enabled`,!1),callTokenType:n.getString(`${i}_call_token_type`),callTokenIntrospectAge:n.getNumber(`${i}_call_token_introspect_age`),
issuer:n.getString(`${i}_issuer`),oauthRealization:n.getString(`${i}_oauth_realization`),disableWebcryptoApi:n.getBoolean(l,!1)};e.create(u,h)}static loadOidcg01(e,t=!1){
let i=`${o}${c}`,s=n.getBoolean(`${i}_enabled`,!1);if("boolean"!=typeof s&&(s=false),!s)return;let r=n.getString(`${i}_uri`,!1),u=n.getBoolean(`${i}_verify_audience`,!1);null==u&&(u=false);let h={
force:t,serviceUri:r||"https://oidc.plus4u.net/uu-oidcg01-main/99923616732452117-4f06dafc03cb4c7f8c155aa53f0e86be",verifySsl:n.getBoolean(`${i}_verify_ssl`,!1),
accessTokenPattern:n.getString(`${i}_access_token_pattern`,!1)||"^UUOIDCAT-.*",refreshTokenPattern:n.getString(`${i}_refresh_token_pattern`,!1)||"^UUOIDCRT-.*",verifyAudience:u,
allowAudienceAlias:n.getBoolean(a,!1),tokenCacheSize:n.getNumber(`${i}_token_cache_size`,!1),tokenTimeLeeway:n.getNumber(`${i}_token_time_leeway`,!1),
discoveryCacheTtl:n.getNumber(`${i}_discovery_cache_ttl`,!1),jwksCacheTtl:n.getNumber(`${i}_jwks_cache_ttl`,!1),defaultScope:n.getString(`${i}_default_scope`,!1),
perflogEnabled:n.getBoolean(`${i}_perflog_enabled`,!1),callTokenType:n.getString(`${i}_call_token_type`),callTokenIntrospectAge:n.getNumber(`${i}_call_token_introspect_age`),
issuer:n.getString(`${i}_issuer`),oauthRealization:n.getString(`${i}_oauth_realization`),disableWebcryptoApi:n.getBoolean(l,!1)};e.create(c,h)}}},568:(e,t,i)=>{"use strict"
;const{AppClient:n}=i(44),{BaseError:s,LruCache:r}=i(498),{PerflogHandler:o,RemoteErrorHandler:a,RetryHandler:l,TransformParametersHandler:c}=i(44),u=[o,a,l,c],h=[a,l,c],d={maxAttempts:3,
maxTimeInterval:3e4,baseTimeInterval:100,retryCondition:{httpMethods:["GET","POST"],httpStatusCodes:["5xx"]}},_=new r({maxSize:16,localStorageKey:"uu_app_oidc_cache_discovery"});e.exports=class{
constructor(e,t={}){if(!e)throw new s("Service URI must be defined");let i=t.discoveryPath||".well-known/openid-configuration";this._discoveryUri=`${e}/${i.replace(/^\//,"")}`,
this._discoveryCacheTtl=1e3*(t.discoveryCacheTtl?Number(t.discoveryCacheTtl):3600);let r="boolean"!=typeof t.perflogEnabled||t.perflogEnabled?u:h;this._client=new n(Object.assign(t,{interceptors:r,
retryPolicy:d}))}async getMetadata(e=!1){let t=_.get(this._discoveryUri);if(!t||e){t=(await this._client.get(this._discoveryUri)).data,_.set(this._discoveryUri,t,this._discoveryCacheTtl)}return t}}},
318:(e,t,i)=>{"use strict";const n=i(460).Session,s=i(460).Identity,r=i(460).ClientIdentity,o=i(460).ApplicationIdentity;e.exports=class extends n{constructor(){super({
authenticationTime:new Date(Date.now()),authenticationLevelOfAssurance:0,identity:new s(null),clientIdentity:new r(null),applicationIdentity:new o(null),attributes:{}})}getServiceName(){return null}
async getServiceUri(){return null}getProviderUri(){return null}async getCallToken(e,t={}){return null}}},54:(e,t,i)=>{"use strict"
;const{BaseError:n,LruCache:s}=i(498),{AppClient:r}=i(44),{InvalidCredentials:o}=i(460),{PerflogHandler:a,RemoteErrorHandler:l,RetryHandler:c,TransformParametersHandler:u}=i(44),h=[a,l,c,u],d=[l,c,u],_={
maxAttempts:3,maxTimeInterval:3e4,baseTimeInterval:100,retryCondition:{httpMethods:["GET","POST"],httpStatusCodes:["5xx"]}},p=new s({maxSize:16,localStorageKey:"uu_app_oidc_cache_jwks"})
;e.exports=class{constructor(e,t={}){if(!e)throw new n("Instance of discovery must be provided");this._discovery=e,this._jwksCacheTtl=1e3*(t.jwksCacheTtl?Number(t.jwksCacheTtl):3600)
;let i="boolean"!=typeof t.perflogEnabled||t.perflogEnabled?h:d;this._client=new r(Object.assign(t,{interceptors:i,retryPolicy:_}))}async getPublicKeyData(e){
let t=await this.getPublicKeySet(),i=t&&t.keys.find((t=>t.kid===e));if(!i&&(t=await this.getPublicKeySet(!0),i=t&&t.keys.find((t=>t.kid===e)),!i)){let t=(await this._discovery.getMetadata()).issuer
;throw new o(`Unable to obtain public JWK key with jwk_id=${e} from ${t}.`)}return i}async getPublicKeySet(e=!1){let t=await this._discovery.getMetadata(),i=t.issuer,n=p.get(i)
;return n&&!e||(n=(await this._client.get(t.jwks_uri)).data,p.set(i,n,this._jwksCacheTtl)),n}}},573:(e,t,i)=>{"use strict"
;const n="undefined"==typeof window?i(839):window.crypto,s=n&&n.subtle||n&&n.webcrypto&&n.webcrypto.subtle,{InvalidCredentials:r}=i(460),{Base64:o,Json:a}=i(498),l=i(54),c=/^[a-zA-Z0-9\-_]+\.[a-zA-Z0-9\-_]+\.[a-zA-Z0-9\-_]+$/,u="RS256",h={
name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};e.exports=class{constructor(e,t={}){if(!e)throw new BaseError("Instance of discovery must be provided");this._discovery=e,
this._jwks=new l(this._discovery,t),this._customIssuer=t.issuer,this._tokenTimeLeeway=t.tokenTimeLeeway?Number(t.tokenTimeLeeway):300,
this._disableWebcryptoApi="boolean"==typeof t.disableWebcryptoApi&&t.disableWebcryptoApi,this._textEncoder=new TextEncoder}async parseToken(e,t=!0,i={}){
if(!e||!e.match(c))throw new r("Unsupported token format.");let n,s,l=e.split(".");try{n=a.parse(o.urlSafeDecode(l[0])),s=a.parse(o.urlSafeDecode(l[1]))}catch(e){
throw new r("Parsing of token failed.",e)}return t&&await this._verifyToken(n,s,l,i),s}async createToken(e,t){let r,l={alg:u,typ:"JWT"
},c=o.urlSafeEncode(a.stringify(l))+"."+o.urlSafeEncode(a.stringify(e));if(s&&!this._disableWebcryptoApi){t.includes("RSA PRIVATE KEY")&&(t=(t=n.createPrivateKey(t)).export({format:"pem",type:"pkcs8"
})),t=o.decode(t.split("\n").slice(1,-1).join(),"binary");let e=await s.importKey("pkcs8",t,h,!0,["sign"]);r=await s.sign(h,e,this._textEncoder.encode(c))}else{let e;if("undefined"==typeof window){
let t="jsrsasign";e=i(60)(t)}else e=await i.e(699).then(i.t.bind(i,699,19));let n=new e.KJUR.crypto.Signature({alg:"SHA256withRSA"});n.init(t),n.updateString(c),
r=Uint8Array.from(n.sign().match(/.{1,2}/g).map((e=>parseInt(e,16))))}return c+"."+o.urlSafeEncode(r)}isExpired(e,t=null){return t=null!=t?t:this._tokenTimeLeeway,e.exp&&e.exp<Date.now()/1e3-t}
verifyExpiration(e,t=null){if(this.isExpired(e,t))throw new r("Token is expired.")}async _verifyToken(e,t,n,a={}){this.verifyExpiration(t,a&&a.leeway);let l=a&&a.issuer
;if(l)Array.isArray(l)||(l=[l]);else{let e=await this._discovery.getMetadata();l=[e.issuer],e.access_token_issuer&&l.push[e.access_token_issuer],this._customIssuer&&l.push[this._customIssuer]}
if(!l.includes(t.iss))throw new r("Unsupported issuer.");let c=a&&a.publicKey;c||(c=await this._jwks.getPublicKeyData(e.kid));let d=c.alg;if(!d){
d=((await this._discovery.getMetadata()).id_token_signing_alg_values_supported||[])[0],d||(d=u)}if(e.alg!=u)throw new r("Unexpected signature algorithm.")
;let _,p=n[0]+"."+n[1],g=o.decode(n[2],"binary");if(s&&!this._disableWebcryptoApi)try{let e=await s.importKey("jwk",c,h,!1,["verify"]);p=this._textEncoder.encode(p),_=await s.verify(h,e,g,p)}catch(e){
throw new r("Unable to verify signature.",e)}else{let e;if("undefined"==typeof window){let t="jsrsasign";e=i(60)(t)}else e=await i.e(699).then(i.t.bind(i,699,19));try{
g=g.reduce(((e,t)=>e+t.toString(16).padStart(2,"0")),""),c=e.KEYUTIL.getKey(c);let t=new e.KJUR.crypto.Signature({alg:"SHA256withRSA"});t.init(c),t.updateString(p),_=t.verify(g)}catch(e){
throw new r("Unable to verify signature.",e)}}if(!_)throw new r("Invalid token signature.")}}},423:(e,t,i)=>{"use strict";const{Config:n}=i(498),s=new RegExp("^https?://.*");e.exports=new class{
constructor(){this._localDomainReplaceEnabled=n.getBoolean("uu_app_oidc_local_domain_scope_replace_enabled"),
null==this._localDomainReplaceEnabled&&(this._localDomainReplaceEnabled=n.isProfileActive("development","test")),
this._localDomainReplaceEnabled&&(this._localDomainList=(n.getString("uu_app_oidc_local_domain_list")||"localhost,127.0.0.1").split(",").map((e=>new RegExp(`^https?://${e.trim()}(:\\d{1,5})?($|/)`))),
this._localDomainScope=n.getString("uu_app_oidc_local_domain_call_token_scope")||"https:// http://")}transformScope(e){if(!this._localDomainReplaceEnabled)return e;let t=[],i=[],n=e.split(" ")
;for(let e of n)e.match(s)?this._localDomainList.find((t=>e.match(t)))||i.push(e):t.push(e);return i.length>0?e:`${t.join(" ")} ${this._localDomainScope}`}}},993:(e,t,i)=>{"use strict"
;const{BaseError:n,LruCache:s,Base64:r}=i(498),{AppClient:o,ApplicationError:a}=i(44),{InvalidCredentials:l,AuthenticationError:c}=i(460),{PerflogHandler:u,RemoteErrorHandler:h,RetryHandler:d,TransformParametersHandler:_}=i(44),{UriBuilder:p}=i(706),g=i(30),f=i(568),m=i(573),y=i(423),w=[u,h,d,_],S=[h,d,_],k={
maxAttempts:3,maxTimeInterval:3e4,baseTimeInterval:100,retryCondition:{httpMethods:["GET","POST"],httpStatusCodes:["5xx"]}
},v="client_id",b="application/x-www-form-urlencoded",C="application/json",A="scope",T="grant_type",x="token",I="token_type_hint",P="subject_token",R="subject_token_type",U="actor_token_type",E="refresh_token",$="urn:ietf:params:oauth:token-type:id_token",N="urn:ietf:params:oauth:token-type:access_token",O=`urn:ietf:params:oauth:token-type:${E}`,L="urn:ietf:params:oauth:grant-type:token-exchange",B="client_private_key",F="client_assertion",j="client_assertion_type",M="urn:ietf:params:oauth:client-assertion-type:jwt-bearer",z=/^[a-zA-Z0-9\-_]+\.[a-zA-Z0-9\-_]+\.[a-zA-Z0-9\-_]+$/,D=["none","low","medium","high","veryHigh"],V=["none","low","standard","high","veryHigh"]
;e.exports=class{constructor(e,t={}){if(!e)throw new n("Service URI must be defined");let i=t.tokenCacheSize?Number(t.tokenCacheSize):2048;this._tokenCache=new s({maxSize:i}),
this._tokenTimeLeeway=t.tokenTimeLeeway?Number(t.tokenTimeLeeway):300,this._discovery=new f(e,t),this._jwt=new m(this._discovery,t);let r="boolean"!=typeof t.perflogEnabled||t.perflogEnabled?w:S
;this._client=new o(Object.assign(t,{interceptors:r,retryPolicy:k})),this._metadata=null,this._serviceUri=e,this._customIssuer=t.issuer,this._defaultScope=null!=t.defaultScope?t.defaultScope:"openid",
this._accessTokenPattern=new RegExp(t.accessTokenPattern||".^"),this._refreshTokenPattern=new RegExp(t.refreshTokenPattern||".^"),this._mtlsGateway=t.mtlsGateway}getServiceUri(){
return this._serviceUri}async getMetadata(){return this._metadata=await this._discovery.getMetadata(),this._metadata}getMetadataSync(){
if(!this._metadata)throw new g("Asynchronous method getMetadata must be invoked prior to synchronous invocation");return this._metadata}async getIssuerList(){
let e=await this.getMetadata(),t=[e.issuer];return e.access_token_issuer&&t.push(e.access_token_issuer),this._customIssuer&&t.push(this._customIssuer),t}async getSupportedAcrValues(){
return(await this.getMetadata()).acr_values_supported||[]}getSupportedAcrValuesSync(){return this.getMetadataSync().acr_values_supported||[]}async getUserInfoUri(){
return(await this.getMetadata()).userinfo_endpoint}async getEndSessionUri(){return(await this.getMetadata()).end_session_endpoint}getEndSessionUriSync(){
return this.getMetadataSync().end_session_endpoint}async getCheckSessionIframeUri(){let e=(await this.getMetadata()).check_session_iframe;return this._replaceMtlsGatewayIfNeeded(e)}
async getAuthorizationUri(e,t,i,n,s=null){return await this.getMetadata(),this.getAuthorizationUriSync(e,t,i,n,s)}getAuthorizationUriSync(e,t,i,n,s=null){i&&i.client_id&&(i=i.client_id)
;let r=`${this._replaceMtlsGatewayIfNeeded(this.getMetadataSync().authorization_endpoint)}?`;if(r+=`response_type=${encodeURIComponent(e)}&`,r+=`redirect_uri=${encodeURIComponent(t)}&`,
r+=`client_id=${encodeURIComponent(i)}&`,r+=`scope=${encodeURIComponent(this._getOidcScope(s))}`,n){let e=this.getSupportedAcrValuesSync();if(e&&e.length>0){let t=n.toString()
;e.includes("medium")?t=t.replace("standard","medium"):e.includes("standard")&&(t=t.replace("medium","standard"));let i=t.split(" "),s=[];i.forEach((t=>{if(e.includes(t))s.push(t);else{let i=Number(t)
;e.includes(i)?s.push(i):e[i]?s.push(e[i]):((i=D.indexOf(t))>-1||(i=V.indexOf(t))>-1)&&s.push(i)}})),s=s.filter((e=>null!=e)),s.length>1&&!isNaN(s[0])&&(s=[Math.min(...s)]),
s.length>0&&(r+=`&acr_values=${encodeURIComponent(s.join(" "))}`)}}return r}async grantAuthorizationCodeToken(e,t,i,n=null){let s={};return s[T]="authorization_code",s.code=e,s[v]=t[v],
s[A]=this._getOidcScope(n),i&&(s.redirect_uri=i),await this._grantToken(s,t)}async grantResourceOwnerPasswordCredentialsToken(e,t,i,n=null){let s={};return s[T]="password",s.username=e,s.password=t,
s[A]=this._getOidcScope(n),await this._grantToken(s,i)}async grantImplicitFlowToken(){throw new n("Method not implemented.")}async grantHybridFlowToken(){throw new n("Method not implemented.")}
async grantClientCredentialsToken(e,t=null){let i={};return i[T]="client_credentials",i[A]=this._getOidcScope(t),await this._grantToken(i,e)}async refreshToken(e,t,i=null){let n={}
;return n[T]="refresh_token",n.refresh_token=e,n[A]=this._getOidcScope(i),await this._grantToken(n,t)}async exchangeToken(e,t=null,i,n=null){null!=t&&"object"==typeof t&&(n=i,i=t,t=null);let s={}
;return s[T]=L,s[P]=e,"idToken"===t?s[R]=$:"accessToken"===t?s[R]=N:e.match(z)?s[R]=$:s[R]=N,s[A]=this._getOidcScope(n),await this._grantToken(s,i)}async delegateToken(e,t=null,i,n=null,s,r=null){
null!=t&&"idToken"!==t&&"accessToken"!==t&&(r=s,s=n,i=t,t=null),null!=n&&"object"==typeof n&&(r=s,s=n,n=null);let o={};return o[T]=L,o.actor_token=e,o[P]=i,
"idToken"===t?o[U]=$:"accessToken"===t?o[U]=N:e.match(z)&&(o[U]=$),"idToken"===n?o[R]=$:"accessToken"===n?o[R]=N:i.match(z)&&(o[R]=$),o[A]=this._getOidcScope(r),await this._grantToken(o,s)}
async introspectToken(e,t=null,i=null){null!=t&&"object"==typeof t&&(i=t,t=null);let n=await this.getMetadata(),s=n.token_introspection_endpoint||n.introspection_endpoint,r={};r[x]=e
;let o=this._getTokenTypeHint(e,t);o&&(r[I]=o);let u={};if(u["Content-Type"]=b,u.Accept=C,i){let e,t=await this._createClientAuthnHeader(i);(e=t.match(/^Bearer (.*)/))?(r[v]=i[v],r[F]=e[1],
r[j]=M):u.Authorization=t}let h=null;try{h=await this._client.post(s,r,{headers:u})}catch(e){throw e instanceof a?new l("Invalid credentials.",e):new c("Authentication failed.",e)}
if(!h.active)throw new l("Invalid credentials.");return h.data}async revokeToken(e,t=null){let i=await this.getMetadata(),n=i.token_revocation_endpoint||i.revocation_endpoint,s={};s[x]=e
;let r=this._getTokenTypeHint(e);r&&(s[I]=r);let o={};if(o["Content-Type"]=b,o.Accept=C,t){let e,i=await this._createClientAuthnHeader(t);(e=i.match(/^Bearer (.*)/))?(s[v]=t[v],s[F]=e[1],
s[j]=M):o.Authorization=i}let u=null;try{u=await this._client.post(n,s,{headers:o})}catch(e){throw e instanceof a?new l("Invalid credentials.",e):new c("Authentication failed.",e)}return u.data}
async parseToken(e,t=null,i=!0,n=null){let s;return null!=t&&"object"==typeof t?(n=t,i=!0,t=null):"boolean"==typeof t?(n="object"==typeof i?i:null,i=t,t=null):"object"==typeof i&&(n=i,i=!0),
e.match(z)?s=await this._jwt.parseToken(e,i):(s=await this.introspectToken(e,t,n),i&&this._jwt.verifyExpiration(s)),s}cacheToken(e,t,i){let n=1e3*(t-=2*this._tokenTimeLeeway)-Date.now()
;n>0&&this._tokenCache.set(e,i,n)}getToken(e){return this._tokenCache.get(e)}deleteToken(e){return this._tokenCache.delete(e)}listTokens(e){this._tokenCache.forEach(e)}async _grantToken(e,t=null){
let i=(await this.getMetadata()).token_endpoint,n={};if(n["Content-Type"]=b,n.Accept=C,t){let i,s=await this._createClientAuthnHeader(t);(i=s.match(/^Bearer (.*)/))?(e[v]=t[v],e[F]=i[1],
e[j]=M):n.Authorization=s}let s=null;try{s=await this._client.post(i,e,{headers:n})}catch(e){throw e instanceof a?new l("Invalid credentials.",e):new c("Authentication failed.",e)}return s.data}
async _createClientAuthnHeader(e){let t=null;if(e[B]){let i=await this.getMetadata(),n=Math.round(Date.now()/1e3),s={jti:Math.random().toString(16).substring(2,10),iat:n,exp:n+600,
aud:i.token_endpoint,iss:e[v],sub:e[v]};t=`Bearer ${await this._jwt.createToken(s,e[B])}`}else{let i=e[v],n=e.client_secret;i=encodeURIComponent(i),t=`Basic ${r.encode(`${i}:${n}`)}`}return t}
_getOidcScope(e){let t=null;return t=Array.isArray(e)?`${this._defaultScope} ${e.join(" ")}`.trim():e?`${this._defaultScope} ${e}`:this._defaultScope,t=y.transformScope(t),t}
_getTokenTypeHint(e,t=null){return t?"idToken"===t?$:"accessToken"===t?N:"refreshToken"===t?E:t:this._accessTokenPattern.test(e)?N:this._refreshTokenPattern.test(e)?O:z.test(e)?$:null}
_replaceMtlsGatewayIfNeeded(e){if(this._mtlsGateway){const t=(new p).parse(e),i=this._mtlsGateway;return t.setGateway(i).toString()}return e}}},30:(e,t,i)=>{"use strict";const{BaseError:n}=i(498)
;e.exports=class extends n{constructor(e,t=null){super(e,t)}}},782:(e,t,i)=>{"use strict"
;const{Config:n,Base64:s,BaseError:r,Digest:o,Json:a}=i(498),{UriBuilder:l}=i(706),{LoggerFactory:c}=i(732),u=i(460).AuthenticationService,h=i(460).Session,{Identity:d,ClientIdentity:_,ApplicationIdentity:p,UuAppKey:g}=i(460),f=i(318),m=i(624),y="uuidentity",w="uu_identity",S="name",k="acr",v="uuappkey",b="appkey",C="uuidentity_type",A="identity_type",T="uuidentity_account_type",x="urn:uuoidcclient:",I="standard"
;e.exports=class extends h{constructor(e,t,i,s=null,r=null,o=null){let a=null,l=null,u=null,h=null,f=null,m=null,P=null,R=null,U=s,E=`uu_app_oidc_providers_${e}_`;if(U){a=U.jti,l=U.auth_id||U.sid
;let e=U.auth_time||U.iat;e&&(u=new Date(1e3*e));let t,s=U[k]
;h=null==s?1:i.indexOf(s)>-1?i.indexOf(s):i.indexOf(s.toString())>-1?i.indexOf(s.toString()):i.indexOf(Number(s.toString()))>-1?i.indexOf(Number(s.toString())):Number(s.toString())
;let r=n.getString(`${E}uu_identity_claim`);if(t=r?U[r]:U[y]||U[w],t){let e=U.loa,i=U[k],n=U[v]||U[b];n&&(n=g.parse(n));let s=U[S];"0-0"===t&&(h=0);let r=U[C]||U[A],o=U[T]||I;f=new d(t,{name:s,
levelOfAssurance:e,type:r,authenticationLevelOfAssurance:i,uuAppKey:n,accountType:o}),f.getAccountType=()=>o}let o=U.client_app_code,c=U.client_uuidentity;if(o||c){let e={};e.id=U.client_app_id,
e.code=o,e.name=U.client_app_name;let t=U.client_uuappkey||U.client_appkey;t&&(e.uuAppKey=g.parse(t)),e.authenticationLevelOfAssurance=U.client_acr,e.type=U.client_uuidentity_type;let i=U.client_uri
;if(i){if(e.uri=i,e.uri&&e.uri.startsWith(x)){let[t,i]=e.uri.replace(x,"").split(/[:\/](.*)/),[n,s]=i.split(/[:\-]/);e.code||(e.code=t.toUpperCase().replace(/-/g,".")),
e.name||(e.name=t.replace(/(-\w)/g,(function(e){return e[1].toUpperCase()})));let[r,o,a]=t.split("-");e.product=t,e.vendor=r,e.app=o,e.subApp=a,e.asid=n,e.awid=s}}else if(e.code){
let[t,i,n]=e.code.toLowerCase().split(/[\.\-_]/),s=`${t}-${i}-${n}`;e.vendor=t,e.app=i,e.subApp=n,e.product=s,e.uri=`${x}${s}`}P=new _(c,e),R=new p(c,e)}let $=U.act;if($){
let e,t=n.getString(`${E}uu_identity_claim`);e=t?$[t]:$[y]||U[w];let i=$[S],s=$[C]||$[A],r=$.loa,o=$[k],a=$[v]||$[b];a&&(a=g.parse(a));let l=$[T]||I;m=new d(e,{name:i,levelOfAssurance:r,type:s,
authenticationLevelOfAssurance:o,uuAppKey:a,accountType:l}),m.getAccountType=()=>l}}super({id:a,authenticationId:l,authenticationTime:u,authenticationLevelOfAssurance:h,identity:f,actorIdentity:m,
clientIdentity:P,applicationIdentity:R,attributes:U}),this._configPrefix=E,this._serviceName=e,this._oauthClient=t,this._supportedAcrValues=i,this._idToken=r,this._accessToken=o,
this._logger=c.get("uuapp.oidc.Session"),
this._authenticated||this._authenticationLevelOfAssurance||(this._authenticated=this._identity&&this._identity.getUuIdentity()&&"0-0"!==this._identity.getUuIdentity()),this._actorIdentity=m}
getServiceName(){return this._serviceName}async getServiceUri(){let e=u.get(this._serviceName);return"function"==typeof e.getServiceUri?await e.getServiceUri():null}getProviderUri(){
let e=u.get(this._serviceName);return"function"==typeof e.getProviderUri?e.getProviderUri():null}getActorIdentity(){return this._actorIdentity}async getCallTokenScope(e,t={}){
let i,s=t?t.scopeMode:null;if(null==s){let e=`${this._configPrefix}default_call_token_scope_mode`;s=n.getString(e)||"baseUri"}if("none"===s)return null;if("baseUri"===s&&t.baseUri){
if(i=t.baseUri.toString().replace(/^\/|\/$/g,""),!i.match(/^https?:/i)){i=`${(t.gatewayUri||"https://uuapp.plus4u.net").replace(/\/$/,"")}/${i}`}}else try{let t=l.parse(e);if(t.clearParameters(),
"useCase"===s)i=t.toUri().toString();else{if("allUseCases"!==s&&"baseUri"!==s)throw new r(`Unsupported scope mode: ${s}`);t.setUseCase(null),i=t.toUri().toString()}}catch(t){
i=e.toString().split("?")[0],i=i.replace(/\/$/,"")}return i}async getCallToken(e,t={}){let i=t?t.useTokenExchange:null;if("boolean"!=typeof i){let e=`${this._configPrefix}use_token_exchange`
;i=!n.hasKey(e)||n.getBoolean(e)}let s=t?t.callTokenType:null;if(!s){let e=`${this._configPrefix}call_token_type`;s=n.getString(e)}let a=!!t&&t.excludeAuthenticationType,l=null;if(i){
let t,i=await m.getClientId(this._serviceName)
;t=Array.isArray(e)?o.sha1(`${this.getIdentity().getUuIdentity()}:${this.getAuthenticationId()}:${i}:${e.sort().join("|")}`):o.sha1(`${this.getIdentity().getUuIdentity()}:${this.getAuthenticationId()}:${i}:${e}`)
;let n=await this._oauthClient.getToken(t);if(!n){let i,r;"idToken"===s?(i=this._idToken,r=s):"accessToken"===s&&(i=this._accessToken,r=s),i||(this._idToken?(i=this._idToken,
r="idToken"):this._accessToken&&(i=this._accessToken,r="accessToken"));let o=await m.getClientCredentials(this._serviceName);n=await this._oauthClient.exchangeToken(i,r,o,e)
;let a=n.expires_at||Number(new Date/1e3+n.expires_in);this._oauthClient.cacheToken(t,a,n)}"idToken"===s?l=n.id_token:"accessToken"===s?l=n.access_token:s||(l=n.id_token||n.access_token)
}else"idToken"===s?l=this._idToken:"accessToken"===s?l=this._accessToken:s||(l=this._idToken||this._accessToken);if(!l)throw new r(`Call token of type "${s||"idToken"}" is not available.`)
;return!0===a?l:`Bearer ${l}`}async actAs(e,t=null,i={}){null==t||"string"==typeof t||Array.isArray(t)||(i=t,t=null);let r=i?i.callTokenType:null;if(!r){let e=`${this._configPrefix}call_token_type`
;r=n.getString(e)}let l=null;"idToken"===r?l=this._idToken:"accessToken"===r?l=this._accessToken:r||(l=this._idToken||this._accessToken);let c,u=await m.getClientId(this._serviceName)
;c=Array.isArray(t)?o.sha1(`${this.getIdentity().getUuIdentity()}:${this.getAuthenticationId()}:${e}:${u}:${t.sort().join("|")}`):o.sha1(`${this.getIdentity().getUuIdentity()}:${this.getAuthenticationId()}:${e}:${u}:${t}`)
;let h=await this._oauthClient.getToken(c),d=await m.getClientCredentials(this._serviceName);if(!h){let i=s.urlSafeEncode(a.stringify({uuidentity:e}))
;h=await this._oauthClient.delegateToken(l,r,i,d,t);let n=h.expires_at||Number(new Date/1e3+h.expires_in);this._oauthClient.cacheToken(c,n,h)}
let _=await this._oauthClient.parseToken(h.id_token,"id_token",!0,d),p=await this._oauthClient.getSupportedAcrValues()
;return new this.constructor(this._serviceName,this._oauthClient,p,_,h.id_token,h.access_token)}async close(){super.close();let e=await m.getClientCredentials(this._serviceName)
;if(this._idToken||this._accessToken)try{await this._oauthClient.revokeToken(this._idToken||this._accessToken,e)}catch(e){this._logger.error("Token revocation failed.",e)}
this._oauthClient.listTokens(((e,t)=>{if(t.id_token==this._idToken||t.access_token==this._accessToken)return this._oauthClient.deleteToken(e),!1})),this._idToken=null,this._accessToken=null}
static _createEmptySession(){return new f}}},927:(e,t,i)=>{
var n=i(145),s="undefined"!=typeof document,r=((n?n.uri:s&&(document.currentScript||Array.prototype.slice.call(document.getElementsByTagName("script"),-1)[0]||{}).src)||"").toString(),o="/3.0.0/"
;(r=r.split(/\//).slice(0,-1).join("/")+"/").substr(-7)===o&&(r=r.substr(0,r.length-7)+"/3.9.0/"),i.p=r,e.exports=i(336);var a=e.exports
;a&&"object"==typeof a&&("version"in a||Object.defineProperty(a,"version",{configurable:!0,value:"3.9.0"}),"name"in a||Object.defineProperty(a,"name",{configurable:!0,
value:"uu_appg01_oidc".split(/[\/\\]/).pop()}),"namespace"in a||Object.defineProperty(a,"namespace",{configurable:!0,value:"UuApp.Oidc"}))},60:e=>{function t(e){
var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=60,e.exports=t},145:t=>{"use strict";t.exports=e},729:e=>{"use strict";e.exports=t},
839:()=>{}},a={};function l(e){var t=a[e];if(void 0!==t)return t.exports;var i=a[e]={exports:{}};return o[e](i,i.exports,l),i.exports}return l.m=o,
n=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,l.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e
;if(16&t&&"function"==typeof e.then)return e}var s=Object.create(null);l.r(s);var r={};i=i||[null,n({}),n([]),n(n)]
;for(var o=2&t&&e;"object"==typeof o&&!~i.indexOf(o);o=n(o))Object.getOwnPropertyNames(o).forEach((t=>r[t]=()=>e[t]));return r.default=()=>e,l.d(s,r),s},l.d=(e,t)=>{
for(var i in t)l.o(t,i)&&!l.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},l.f={},l.e=e=>Promise.all(Object.keys(l.f).reduce(((t,i)=>(l.f[i](e,t),t)),[])),
l.u=e=>"chunks/uu_appg01_oidc/"+e+"-3c8ca8d676ea41361a79.min.js",l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s={},r="UuApp.Oidc:",l.l=(e,t,i,n)=>{if(s[e])s[e].push(t);else{var o,a
;if(void 0!==i)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var h=c[u];if(h.getAttribute("src")==e||h.getAttribute("data-webpack")==r+i){o=h;break}}o||(a=!0,
(o=document.createElement("script")).charset="utf-8",o.timeout=120,l.nc&&o.setAttribute("nonce",l.nc),o.setAttribute("data-webpack",r+i),o.src=e,
0!==o.src.indexOf(window.location.origin+"/")&&(o.crossOrigin="anonymous")),s[e]=[t];var d=(t,i)=>{o.onerror=o.onload=null,clearTimeout(_);var n=s[e];if(delete s[e],
o.parentNode&&o.parentNode.removeChild(o),n&&n.forEach((e=>e(i))),t)return t(i)},_=setTimeout(d.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=d.bind(null,o.onerror),
o.onload=d.bind(null,o.onload),a&&document.head.appendChild(o)}},l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),
Object.defineProperty(e,"__esModule",{value:!0})},l.p="",(()=>{var e={826:0};l.f.j=(t,i)=>{var n=l.o(e,t)?e[t]:void 0;if(0!==n)if(n)i.push(n[2]);else{var s=new Promise(((i,s)=>n=e[t]=[i,s]))
;i.push(n[2]=s);var r=l.p+l.u(t),o=new Error;l.l(r,(i=>{if(l.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var s=i&&("load"===i.type?"missing":i.type),r=i&&i.target&&i.target.src
;o.message="Loading chunk "+t+" failed.\n("+s+": "+r+")",o.name="ChunkLoadError",o.type=s,o.request=r,n[1](o)}}),"chunk-"+t,t)}};var t=(t,i)=>{var n,s,[r,o,a]=i,c=0;if(r.some((t=>0!==e[t]))){
for(n in o)l.o(o,n)&&(l.m[n]=o[n]);if(a)a(l)}for(t&&t(i);c<r.length;c++)s=r[c],l.o(e,s)&&e[s]&&e[s][0](),e[s]=0
},i=this.__webpack_jsonp_uu_appg01_oidc_3_9_0_uu_appg01_oidc=this.__webpack_jsonp_uu_appg01_oidc_3_9_0_uu_appg01_oidc||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),l(927)})()));